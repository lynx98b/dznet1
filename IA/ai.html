<!-- ==========================================================
 G√©n√©rateur de Prompt - Contenu HTML Enfant
 Version : v1.015 (Export/Import + Historique)
========================================================== -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CRRK6Z4D1X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CRRK6Z4D1X');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="G√©n√©rateur de prompt pour contenu HTML enfant - Version professionnelle" />
  <title>G√©n√©rateur Prompt Contenu Enfant - v1.015</title>

  <style>
    /* ===== VARIABLES & RESET ===== */
    :root{
      --primary:#4A90E2;--success:#27AE60;--warning:#F39C12;--danger:#E74C3C;--info:#3498DB;
      --bg-light:#F8F9FA;--text-dark:#2C3E50;--border:#DFE6E9;--shadow:rgba(0,0,0,0.1);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;padding:20px;color:var(--text-dark)
    }
    .container{max-width:1000px;margin:0 auto;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden}
    header{background:linear-gradient(135deg,var(--primary) 0%,#357ABD 100%);color:#fff;padding:30px;text-align:center;position:relative}
    header h1{font-size:26px;margin-bottom:10px}
    header p{font-size:14px;opacity:.95}
    .version-badge{position:absolute;top:15px;right:15px;background:rgba(255,255,255,.2);padding:5px 15px;border-radius:20px;font-size:12px;font-weight:600}
    .help-btn{position:absolute;top:15px;left:15px;background:var(--warning);color:#fff;border:none;padding:10px 20px;border-radius:25px;cursor:pointer;font-weight:600;font-size:14px;transition:.3s;display:flex;align-items:center;gap:8px}
    .help-btn:hover{background:#E67E22;transform:scale(1.05)}
    
    .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.7);animation:fadeIn .3s;overflow-y:auto;padding:20px}
    .modal.active{display:flex;align-items:center;justify-content:center}
    .modal-content{background:#fff;padding:40px;border-radius:16px;max-width:700px;width:100%;max-height:85vh;overflow-y:auto;position:relative;animation:slideDown .4s}
    .modal-content.large{max-width:900px}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideDown{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}
    .modal-close{position:absolute;top:15px;right:15px;background:var(--danger);color:#fff;border:none;width:35px;height:35px;border-radius:50%;cursor:pointer;font-size:20px;font-weight:700;transition:.3s}
    .modal-close:hover{background:#C0392B;transform:rotate(90deg)}
    .modal-content h2{color:var(--primary);margin-bottom:20px;font-size:24px}
    .modal-content h3{color:var(--success);margin-top:25px;margin-bottom:15px;font-size:18px}
    
    .result-modal .modal-content{padding:0;overflow:hidden}
    .result-header{background:linear-gradient(135deg,var(--success) 0%,#229954 100%);color:#fff;padding:25px 40px;text-align:center}
    .result-header h2{color:#fff;margin:0 0 10px 0;font-size:26px}
    .result-body{padding:30px 40px;max-height:60vh;overflow-y:auto}
    #promptOutputModal{background:#F8F9FA;padding:20px;border-radius:8px;border:2px solid var(--border);font-family:'Courier New',monospace;font-size:13px;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;max-height:400px;overflow-y:auto}
    .result-actions{padding:20px 40px 30px 40px;background:var(--bg-light);display:flex;gap:15px;flex-wrap:wrap}

    .form-wrapper{padding:40px}
    .metadata-section{background:#FFF9E6;padding:20px;border-radius:12px;margin-bottom:30px;border:2px solid var(--warning)}
    .metadata-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:15px}
    .section{margin-bottom:40px;padding-bottom:30px;border-bottom:2px solid var(--border)}
    .section:last-child{border-bottom:none}
    .section-title{font-size:20px;color:var(--primary);margin-bottom:20px;display:flex;align-items:center;gap:10px}
    .form-group{margin-bottom:20px;position:relative}
    label{display:block;font-weight:600;margin-bottom:8px;font-size:15px}
    label.required::after{content:" *";color:var(--danger)}

    .error-message{display:none;color:var(--danger);font-size:13px;font-weight:600;margin-top:5px;padding:8px 12px;background:#FADBD8;border-radius:4px;border-left:3px solid var(--danger)}
    .form-group.has-error .error-message{display:block;animation:shake .5s}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
    .form-group.has-error input,.form-group.has-error select,.form-group.has-error textarea{border-color:var(--danger);background:#FADBD8}

    input[type="text"],input[type="date"],select,textarea{width:100%;padding:12px;border:2px solid var(--border);border-radius:8px;font-size:14px;transition:.3s;font-family:inherit}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(74,144,226,.1)}
    textarea{min-height:80px;resize:vertical}

    .checkbox-group,.radio-group{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:12px}
    .checkbox-item,.radio-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--bg-light);border-radius:8px;cursor:pointer;transition:.3s;border:2px solid transparent}
    .checkbox-item:hover,.radio-item:hover{background:#E8F4F8;border-color:var(--primary)}
    .checkbox-item input:checked ~ span,.radio-item input:checked ~ span{font-weight:600;color:var(--primary)}
    input[type="checkbox"],input[type="radio"]{width:20px;height:20px;cursor:pointer;flex-shrink:0}

    /* ===== ACCORDION OBJECTIFS ===== */
    .search-box{margin-bottom:15px;position:relative}
    .search-box input{padding-left:40px}
    .search-box::before{content:"üîç";position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:18px;pointer-events:none}
    
    .goals-accordion{border:2px solid var(--border);border-radius:8px;max-height:400px;overflow-y:auto}
    .category{border-bottom:1px solid var(--border)}
    .category:last-child{border-bottom:none}
    .category-toggle{width:100%;padding:15px;background:#F8F9FA;border:none;text-align:left;cursor:pointer;font-weight:600;font-size:15px;display:flex;justify-content:space-between;align-items:center;transition:.3s}
    .category-toggle:hover{background:#E8F4F8}
    .category-toggle.active{background:var(--primary);color:#fff}
    .category-content{max-height:0;overflow:hidden;transition:max-height .3s ease;padding:0 15px}
    .category-content.expanded{max-height:1000px;padding:15px}
    .category-content .checkbox-group{grid-template-columns:1fr}
    .category-icon{transition:transform .3s}
    .category-toggle.active .category-icon{transform:rotate(180deg)}
    
    .selected-goals-preview{background:#E8F4F8;padding:15px;border-radius:8px;margin-top:15px;font-size:14px;border-left:4px solid var(--info)}
    .selected-goals-preview strong{color:var(--primary)}

    .color-palette{display:flex;gap:10px;align-items:center;padding:10px;background:#fff;border-radius:8px;border:2px solid var(--border)}
    .color-palette input[type="radio"]{margin-right:10px}
    .color-swatch{width:30px;height:30px;border-radius:4px;border:2px solid #ddd}
    .palette-name{font-weight:600;flex:1}

    .button-group{display:flex;gap:15px;flex-wrap:wrap;margin-top:30px}
    button{padding:15px 30px;font-size:16px;font-weight:600;border:none;border-radius:8px;cursor:pointer;transition:.3s;display:flex;align-items:center;gap:10px;justify-content:center}
    button:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:var(--primary);color:#fff;flex:1;min-width:200px}
    .btn-primary:hover:not(:disabled){background:#357ABD;transform:translateY(-2px);box-shadow:0 5px 15px rgba(74,144,226,.4)}
    .btn-success{background:var(--success);color:#fff;flex:1;min-width:200px}
    .btn-success:hover:not(:disabled){background:#229954;transform:translateY(-2px);box-shadow:0 5px 15px rgba(39,174,96,.4)}
    .btn-secondary{background:var(--border);color:var(--text-dark)}
    .btn-secondary:hover{background:#BDC3C7}
    .btn-small{padding:8px 15px;font-size:13px;min-width:auto;}
    .btn-danger{background:var(--danger);color:#fff;}
    .btn-danger:hover{background:#C0392B;}
    .spinner{display:none;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    button.loading .spinner{display:block}
    button.loading span:not(.spinner){display:none}
    .helper-text{font-size:13px;color:#7F8C8D;margin-top:5px;font-style:italic}
    .info-banner{background:#E3F2FD;border-left:4px solid var(--info);padding:15px;margin:20px 0;border-radius:4px;font-size:14px}
    .feature-badge{display:inline-block;background:var(--success);color:#fff;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;margin-left:8px}

    .format-toggle{display:flex;gap:10px;margin-bottom:20px;background:var(--bg-light);padding:15px;border-radius:8px}
    .format-option{flex:1;text-align:center;padding:10px;border-radius:6px;cursor:pointer;transition:.3s;border:2px solid transparent}
    .format-option.active{background:var(--primary);color:#fff;border-color:var(--primary)}
    .format-option:not(.active):hover{background:#E8F4F8;border-color:var(--primary)}
    .json-preview{background:#2C3E50;color:#ECF0F1;padding:15px;border-radius:8px;font-family:'Courier New',monospace;font-size:12px;max-height:200px;overflow-y:auto;margin-top:10px;display:none}
    .json-key{color:#3498DB}.json-string{color:#27AE60}.json-number{color:#E74C3C}.json-boolean{color:#9B59B6}

    .preset-hint{display:inline-block;margin-left:8px;font-size:12px;color:#2d6cdf;background:#E8F0FE;border:1px solid #BFD1FF;border-radius:999px;padding:2px 8px}
    .tiny{font-size:12px;opacity:.8}

    .form-group.disabled-field {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }
    .disabled-tooltip {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(149, 165, 166, 0.05);
        border-radius: 8px;
        border: 2px dashed #bdc3c7;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: help;
        z-index: 1;
    }
    .disabled-tooltip-text {
        display: none;
        position: absolute;
        top: -60px;
        left: 50%;
        transform: translateX(-50%);
        background: #34495e;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 13px;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10;
    }
    .disabled-tooltip-text::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 8px solid #34495e;
    }
    .disabled-tooltip:hover .disabled-tooltip-text {
        display: block;
    }
    .disabled-icon {
        font-size: 24px;
        opacity: 0.4;
    }

    /* ===== HISTORIQUE ===== */
    .history-item {
      background: var(--bg-light);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 12px;
      border: 2px solid var(--border);
      transition: .3s;
    }
    .history-item:hover {
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(74,144,226,.2);
    }
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .history-title {
      font-weight: 700;
      color: var(--primary);
      font-size: 16px;
    }
    .history-date {
      font-size: 12px;
      color: #7F8C8D;
    }
    .history-meta {
      display: flex;
      gap: 15px;
      font-size: 13px;
      color: #7F8C8D;
      margin-bottom: 10px;
    }
    .history-actions {
      display: flex;
      gap: 8px;
    }
    .empty-history {
      text-align: center;
      padding: 40px;
      color: #95A5A6;
    }
    .empty-history-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    @media (max-width:768px){
      body{padding:10px}
      .form-wrapper{padding:20px}
      header h1{font-size:20px}
      .help-btn,.version-badge{position:static;margin:10px auto}
      header{padding:20px}
      .button-group{flex-direction:column}
      .btn-primary,.btn-success{width:100%}
      .checkbox-group,.radio-group{grid-template-columns:1fr}
      .modal-content{padding:25px;margin:20px;max-height:90vh}
      .result-header,.result-body,.result-actions{padding:20px}
      .metadata-grid{grid-template-columns:1fr}
      .category-content .checkbox-group{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <header>
      <button class="help-btn" onclick="openHelpModal()">
        <span>‚ùì</span><span>Guide</span>
      </button>
      <span class="version-badge">v1.015</span>
      <h1>üé® G√©n√©rateur de Prompt - Contenu HTML Enfant</h1>
      <p>Cr√©ez des exp√©riences √©ducatives interactives s√©curis√©es et coh√©rentes</p>
      <p class="tiny">‚úÖ Export/Import | üìö Historique | üß™ Mode test</p>
    </header>

    <!-- MODAL AIDE -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeHelpModal()">√ó</button>
        <h2>üìò Guide rapide v1.015</h2>
        <div class="info-banner">
          <strong>Nouveaut√©s v1.015 :</strong>
          <ul style="margin:10px 0 0 20px;line-height:1.8">
            <li>üíæ Export/Import de configurations compl√®tes</li>
            <li>üìö Historique des 10 derniers prompts</li>
            <li>üîÑ Rechargement rapide depuis l'historique</li>
          </ul>
        </div>
        <h3>üîç Recherche d'objectifs</h3>
        <p>Tapez un mot-cl√© (ex: "addition", "alphabet") pour filtrer les 80 objectifs p√©dagogiques.</p>
        <button class="btn-primary" onclick="closeHelpModal()" style="margin-top: 16px; width: 100%;">OK</button>
      </div>
    </div>

    <!-- MODAL R√âSULTAT -->
    <div id="resultModal" class="modal result-modal">
      <div class="modal-content large">
        <button class="modal-close" onclick="closeResultModal()">√ó</button>
        <div class="result-header">
          <h2>üéâ Prompt G√©n√©r√©</h2>
          <p class="tiny" style="margin:0;">Copiez ou exportez en .txt</p>
        </div>
        <div class="result-body">
          <div id="promptOutputModal"></div>
        </div>
        <div class="result-actions">
          <button id="copyBtnModal" class="btn-success"><span class="spinner"></span><span>üìã Copier</span></button>
          <button id="downloadBtnModal" class="btn-primary"><span>üíæ Exporter (.txt)</span></button>
          <button onclick="closeResultModal()" class="btn-secondary">‚úñÔ∏è Fermer</button>
        </div>
      </div>
    </div>

    <!-- MODAL HISTORIQUE -->
    <div id="historyModal" class="modal">
      <div class="modal-content large">
        <button class="modal-close" onclick="closeHistoryModal()">√ó</button>
        <h2>üìö Historique des Prompts</h2>
        <div class="info-banner">
          Les 10 derniers prompts g√©n√©r√©s sont sauvegard√©s automatiquement.
        </div>
        <div id="historyList" style="margin-top:20px;"></div>
        <div style="margin-top:20px;display:flex;gap:10px;">
          <button class="btn-danger" onclick="if(confirm('Supprimer tout l\'historique ?')) { historyManager.clear(); renderHistoryList(); }">
            üóëÔ∏è Effacer tout
          </button>
          <button class="btn-secondary" onclick="closeHistoryModal()">Fermer</button>
        </div>
      </div>
    </div>

    <!-- MODAL IMPORT CONFIG -->
    <div id="importModal" class="modal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeImportModal()">√ó</button>
        <h2>üì• Importer une Configuration</h2>
        <div style="margin-top:20px;">
          <input type="file" id="importFileInput" accept=".json" style="display:none;">
          <button class="btn-primary" onclick="document.getElementById('importFileInput').click()" style="width:100%;">
            üìÇ Choisir un fichier JSON
          </button>
          <p class="helper-text" style="margin-top:10px;">
            S√©lectionnez un fichier de configuration pr√©c√©demment export√©.
          </p>
        </div>
      </div>
    </div>

    <!-- FORMULAIRE -->
    <div class="form-wrapper">
      <div class="format-toggle">
        <div class="format-option active" data-format="json">üöÄ Format JSON (Recommand√©)</div>
        <div class="format-option" data-format="text">üìù Format Texte (Ancien)</div>
      </div>
      <div id="jsonPreview" class="json-preview"></div>

      <form id="promptForm">
        <!-- M√âTADONN√âES -->
        <div class="metadata-section">
          <h3 style="color:var(--warning);margin-bottom:15px;">üìù Informations du Projet</h3>
          
          <!-- CHECKBOX VERSION TEST -->
          <div class="form-group" style="margin-bottom:20px;background:#E8F4F8;padding:15px;border-radius:8px;border:2px solid var(--info);">
            <label class="checkbox-item" style="margin:0;cursor:pointer;background:transparent;">
              <input type="checkbox" id="testMode" name="testMode" checked style="width:24px;height:24px;">
              <span style="font-weight:700;color:var(--info);flex:1;">
                üß™ Version test (chemins locaux)
                <span class="helper-text" style="display:block;margin-top:5px;font-weight:400;font-style:italic;">
                  Coch√© : m√©dias dans /images/ et /audio/ pour test PC local. D√©coch√© : utilise les CDN distants. Fallback automatique si m√©dia introuvable.
                </span>
              </span>
            </label>
          </div>

          <div class="metadata-grid">
            <div class="form-group" style="margin-bottom:0;">
              <label for="creatorName" class="required">Votre nom / Pr√©nom</label>
              <input type="text" id="creatorName" placeholder="Ex: Marie Dupont" required maxlength="100">
              <div class="error-message">‚ùå Champ obligatoire</div>
              <span class="helper-text">Sauvegard√© automatiquement</span>
            </div>
            <div class="form-group" style="margin-bottom:0;">
              <label for="projectVersion">Version du projet</label>
              <input type="text" id="projectVersion" value="v1.015" placeholder="v1.015">
            </div>
            <div class="form-group" style="margin-bottom:0;">
              <label>Date de cr√©ation</label>
              <input type="text" id="creationDate" readonly style="background:#f0f0f0;">
            </div>
          </div>
        </div>

        <!-- 1Ô∏è‚É£ PUBLIC CIBLE -->
        <div class="section">
          <h2 class="section-title">1Ô∏è‚É£ Public Cible</h2>
          <div class="form-group" id="ageGroup">
            <label class="required">Tranches d'√¢ge (multiple)</label>
            <div class="checkbox-group">
              <label class="checkbox-item"><input type="checkbox" name="ageRange" value="3-4 ans (Petite section)"><span>3-4 ans</span></label>
              <label class="checkbox-item"><input type="checkbox" name="ageRange" value="5-6 ans (Grande section/CP)"><span>5-6 ans</span></label>
              <label class="checkbox-item"><input type="checkbox" name="ageRange" value="7-8 ans (CE1/CE2)"><span>7-8 ans</span></label>
              <label class="checkbox-item"><input type="checkbox" name="ageRange" value="9-10 ans (CM1/CM2)"><span>9-10 ans</span></label>
              <label class="checkbox-item"><input type="checkbox" name="ageRange" value="11-12 ans (Coll√®ge)"><span>11-12 ans</span></label>
              <label class="checkbox-item"><input type="checkbox" name="ageRange" value="13-14 ans (Coll√®ge)"><span>13-14 ans</span></label>
            </div>
            <div class="error-message">‚ùå S√©lectionnez au moins une tranche d'√¢ge</div>
          </div>

          <div class="form-group" id="readingGroup">
            <label class="required">Niveau de lecture</label>
            <div class="radio-group">
              <label class="radio-item"><input type="radio" name="readingLevel" value="Pr√©-lecteur (images/audio/pictogrammes)" required><span>Pr√©-lecteur</span></label>
              <label class="radio-item"><input type="radio" name="readingLevel" value="Lecteur d√©butant (phrases courtes max 8 mots)"><span>Lecteur d√©butant</span></label>
              <label class="radio-item"><input type="radio" name="readingLevel" value="Lecteur autonome (textes structur√©s)"><span>Lecteur autonome</span></label>
            </div>
            <div class="error-message">‚ùå S√©lectionnez un niveau de lecture</div>
          </div>

          <div class="form-group">
            <label>Supervision adulte</label>
            <div class="radio-group">
              <label class="radio-item"><input type="radio" name="supervision" value="Adulte pr√©sent obligatoire" checked><span>Adulte pr√©sent</span></label>
              <label class="radio-item"><input type="radio" name="supervision" value="Semi-autonome (adulte √† proximit√©)"><span>Semi-autonome</span></label>
              <label class="radio-item"><input type="radio" name="supervision" value="Totalement autonome"><span>Totalement autonome</span></label>
            </div>
          </div>
        </div>

        <!-- 2Ô∏è‚É£ TYPE DE CONTENU -->
        <div class="section">
          <h2 class="section-title">2Ô∏è‚É£ Type de contenu <span class="feature-badge">PRESETS</span></h2>
          <div class="form-group" id="contentTypeGroup">
            <label class="required" for="contentType">Choisir un type</label>
            <select id="contentType" required>
              <option value="">‚Äî S√©lectionner ‚Äî</option>
              <option value="histoire">Histoire</option>
              <option value="jeu_educatif">Jeu √©ducatif</option>
              <option value="encyclopedie">Encyclop√©die</option>
              <option value="exercice">Exercice pratique</option>
              <option value="lecon_vie">Le√ßon de vie</option>
              <option value="quiz">Quiz interactif</option>
              <option value="coloriage">Coloriage / Dessin</option>
              <option value="puzzle">Puzzles</option>
              <option value="memoire">Jeu de m√©moire</option>
              <option value="aventure_choix">Aventure √† choix</option>
              <option value="labyrinthe">Labyrinthe</option>
              <option value="tri_categorie">Tri / Cat√©gorisation</option>
            </select>
            <div class="error-message">‚ùå Choisissez un type</div>
            <div class="helper-text">Cliquez ensuite sur "Appliquer le preset" pour pr√©-remplir.</div>
          </div>
          <div class="button-group" style="margin-top:5px;">
            <button type="button" id="applyPresetBtn" class="btn-success">‚ö° Appliquer le preset</button>
            <button type="button" id="clearSelectionsBtn" class="btn-secondary">üßπ Effacer les s√©lections</button>
            <span id="presetHint" class="preset-hint" aria-live="polite"></span>
          </div>
        </div>

        <!-- 3Ô∏è‚É£ LANGUES -->
        <div class="section">
          <h2 class="section-title">3Ô∏è‚É£ Langue du Contenu</h2>
          <div class="form-group">
            <label>Langue(s) (multiple)</label>
            <div class="checkbox-group">
              <label class="checkbox-item"><input type="checkbox" name="languages" value="Fran√ßais" checked><span>üá´üá∑ Fran√ßais</span></label>
              <label class="checkbox-item"><input type="checkbox" name="languages" value="Arabe"><span>üá©üáø ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span></label>
              <label class="checkbox-item"><input type="checkbox" name="languages" value="Anglais"><span>üá¨üáß English</span></label>
            </div>
            <span class="helper-text">S√©lectionner plusieurs pour contenu bilingue/trilingue</span>
          </div>
          <div class="form-group">
            <label>Disposition multilingue</label>
            <div class="radio-group">
              <label class="radio-item"><input type="radio" name="languageLayout" value="S√©lecteur de langue (bouton pour changer)" checked><span>S√©lecteur</span></label>
              <label class="radio-item"><input type="radio" name="languageLayout" value="Affichage simultan√© c√¥te √† c√¥te"><span>C√¥te √† c√¥te</span></label>
              <label class="radio-item"><input type="radio" name="languageLayout" value="Bilingue avec traduction au survol"><span>Traduction au survol</span></label>
            </div>
          </div>
        </div>

        <!-- 4Ô∏è‚É£ TH√àME & OBJECTIFS -->
        <div class="section">
          <h2 class="section-title">4Ô∏è‚É£ Th√®me et Objectifs P√©dagogiques</h2>
          <div class="form-group" id="themeGroup">
            <label for="theme" class="required">Sujet principal</label>
            <input type="text" id="theme" placeholder="Ex: Apprentissage des couleurs primaires" required>
            <div class="error-message">‚ùå D√©crivez le sujet</div>
            <span class="helper-text">1 phrase claire</span>
          </div>

          <div class="form-group" id="goalsGroup">
            <label class="required">Objectifs p√©dagogiques (80 disponibles)</label>
            <div class="search-box">
              <input type="text" id="searchGoals" placeholder="Rechercher un objectif (ex: addition, alphabet...)">
            </div>
            
            <div class="goals-accordion" id="goalsAccordion">
              <!-- Math√©matiques -->
              <div class="category" data-category="math">
                <button type="button" class="category-toggle">
                  <span>üìê Math√©matiques & Logique <span class="count">(0/15)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Reconnaissance des chiffres 0-10"><span>Chiffres 0-10</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Reconnaissance des chiffres 10-100"><span>Chiffres 10-100</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Comptage et d√©nombrement 1-10"><span>Comptage 1-10</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Comptage et d√©nombrement 1-20"><span>Comptage 1-20</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Comptage et d√©nombrement 1-100"><span>Comptage 1-100</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Addition simple (jusqu'√† 10)"><span>Addition simple</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Soustraction simple (jusqu'√† 10)"><span>Soustraction simple</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Multiplication tables (2, 5, 10)"><span>Tables de multiplication</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Division simple (partage √©quitable)"><span>Division simple</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Comparaison quantit√©s (plus/moins/√©gal)"><span>Comparaison quantit√©s</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="S√©quences et suites logiques"><span>Suites logiques</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Fractions simples (1/2, 1/4)"><span>Fractions simples</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Mesures et longueurs (cm, m)"><span>Mesures/longueurs</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Poids et volumes (g, kg, L)"><span>Poids/volumes</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="R√©solution de probl√®mes math√©matiques"><span>R√©solution de probl√®mes</span></label>
                  </div>
                </div>
              </div>

              <!-- Langues -->
              <div class="category" data-category="langues">
                <button type="button" class="category-toggle">
                  <span>üî§ Langues & Communication <span class="count">(0/12)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Reconnaissance alphabet majuscules"><span>Alphabet majuscules</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Reconnaissance alphabet minuscules"><span>Alphabet minuscules</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Association lettre-son (phon√©tique)"><span>Lettre-son (phon√©tique)</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Formation de syllabes (ba, be, bi, bo, bu)"><span>Formation syllabes</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Lecture de mots simples (3-5 lettres)"><span>Lecture mots simples</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Lecture de phrases courtes"><span>Lecture phrases</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Compr√©hension de textes courts"><span>Compr√©hension textes</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="√âcriture des lettres (graphisme)"><span>√âcriture lettres</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Orthographe mots courants"><span>Orthographe</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Conjugaison pr√©sent/pass√©/futur"><span>Conjugaison</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Vocabulaire th√©matique (animaux, fruits, etc.)"><span>Vocabulaire th√©matique</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Expression orale et narration"><span>Expression orale</span></label>
                  </div>
                </div>
              </div>

              <!-- Formes & Couleurs -->
              <div class="category" data-category="formes">
                <button type="button" class="category-toggle">
                  <span>üé® Formes, Couleurs & Cr√©ativit√© <span class="count">(0/8)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Reconnaissance couleurs primaires (rouge, bleu, jaune)"><span>Couleurs primaires</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Reconnaissance couleurs secondaires (vert, orange, violet)"><span>Couleurs secondaires</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Nuances de couleurs (clair/fonc√©)"><span>Nuances couleurs</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Identification formes g√©om√©triques 2D (carr√©, cercle, triangle)"><span>Formes 2D</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Identification formes g√©om√©triques 3D (cube, sph√®re, cylindre)"><span>Formes 3D</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Sym√©trie et motifs r√©p√©titifs"><span>Sym√©trie/motifs</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Dessin et cr√©ativit√© artistique"><span>Dessin/cr√©ativit√©</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Assemblage et construction spatiale"><span>Construction spatiale</span></label>
                  </div>
                </div>
              </div>

              <!-- Sciences -->
              <div class="category" data-category="sciences">
                <button type="button" class="category-toggle">
                  <span>üåç Sciences & Nature <span class="count">(0/10)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="D√©couverte animaux et leurs habitats"><span>Animaux/habitats</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Cris et sons des animaux"><span>Cris animaux</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Parties du corps humain"><span>Corps humain</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Organes et sant√© (c≈ìur, poumons, cerveau)"><span>Organes/sant√©</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Alimentation √©quilibr√©e et nutrition"><span>Nutrition</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Cycle de l'eau"><span>Cycle de l'eau</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Cycle des saisons"><span>Saisons</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="M√©t√©o et climat"><span>M√©t√©o/climat</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Plantes et v√©g√©taux (croissance, photosynth√®se)"><span>Plantes/v√©g√©taux</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="√âcosyst√®mes (for√™t, oc√©an, d√©sert)"><span>√âcosyst√®mes</span></label>
                  </div>
                </div>
              </div>

              <!-- Temps & Espace -->
              <div class="category" data-category="temps">
                <button type="button" class="category-toggle">
                  <span>‚è∞ Temps & Espace <span class="count">(0/6)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Lecture de l'heure (analogique)"><span>Heure analogique</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Lecture de l'heure (num√©rique)"><span>Heure num√©rique</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Jours de la semaine"><span>Jours semaine</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Mois de l'ann√©e"><span>Mois ann√©e</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Orientation spatiale (gauche/droite, avant/arri√®re)"><span>Orientation spatiale</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Rep√©rage sur plan/carte simple"><span>Rep√©rage plan/carte</span></label>
                  </div>
                </div>
              </div>

              <!-- Socio-√©motionnel -->
              <div class="category" data-category="social">
                <button type="button" class="category-toggle">
                  <span>ü§ù Comp√©tences Sociales & √âmotionnelles <span class="count">(0/10)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Reconnaissance et gestion des √©motions"><span>√âmotions/gestion</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Empathie et compr√©hension d'autrui"><span>Empathie</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Partage et coop√©ration"><span>Partage/coop√©ration</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="R√©solution de conflits"><span>R√©solution conflits</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Respect des r√®gles et consignes"><span>Respect r√®gles</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Autonomie et confiance en soi"><span>Autonomie/confiance</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Patience et pers√©v√©rance"><span>Patience/pers√©v√©rance</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Communication non-violente"><span>Communication non-violente</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Solidarit√© et entraide"><span>Solidarit√©/entraide</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Tol√©rance et respect des diff√©rences"><span>Tol√©rance/diversit√©</span></label>
                  </div>
                </div>
              </div>

              <!-- Vie pratique -->
              <div class="category" data-category="pratique">
                <button type="button" class="category-toggle">
                  <span>üõ°Ô∏è Vie Pratique & S√©curit√© <span class="count">(0/8)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Hygi√®ne corporelle (se laver, se brosser les dents)"><span>Hygi√®ne</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Habillage et autonomie vestimentaire"><span>Habillage</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="S√©curit√© routi√®re (pi√©ton, v√©lo)"><span>S√©curit√© routi√®re</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Gestes de premiers secours basiques"><span>Premiers secours</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Tri et recyclage des d√©chets"><span>Tri/recyclage</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="√âconomie d'eau et d'√©nergie"><span>√âconomie ressources</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Dangers domestiques (√©lectricit√©, produits toxiques)"><span>Dangers domestiques</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Num√©rique responsable (temps d'√©cran, cybers√©curit√©)"><span>Num√©rique responsable</span></label>
                  </div>
                </div>
              </div>

              <!-- Arts & Culture -->
              <div class="category" data-category="arts">
                <button type="button" class="category-toggle">
                  <span>üéµ Arts & Culture <span class="count">(0/6)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Reconnaissance instruments de musique"><span>Instruments musique</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Rythme et tempo musical"><span>Rythme/tempo</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Chant et m√©morisation comptines"><span>Chant/comptines</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Danses et expression corporelle"><span>Danse</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Histoire et patrimoine culturel"><span>Histoire/patrimoine</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="D√©couverte cultures du monde"><span>Cultures du monde</span></label>
                  </div>
                </div>
              </div>

              <!-- M√©moire -->
              <div class="category" data-category="memoire">
                <button type="button" class="category-toggle">
                  <span>üß† M√©moire & Concentration <span class="count">(0/5)</span></span>
                  <span class="category-icon">‚ñº</span>
                </button>
                <div class="category-content">
                  <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="M√©moire visuelle (se souvenir d'images)"><span>M√©moire visuelle</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="M√©moire auditive (se souvenir de sons/mots)"><span>M√©moire auditive</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Attention et concentration soutenue"><span>Concentration</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="M√©morisation de s√©quences"><span>M√©morisation s√©quences</span></label>
                    <label class="checkbox-item"><input type="checkbox" name="pedGoals" value="Observation et attention aux d√©tails"><span>Observation/d√©tails</span></label>
                  </div>
                </div>
              </div>
            </div>

            <div class="selected-goals-preview">
              <strong>S√©lectionn√©s :</strong> <span id="selectedCount">0</span> objectifs
            </div>

            <div class="error-message">‚ùå Choisissez au moins un objectif ou utilisez le champ libre</div>
          </div>

          <div class="form-group">
            <label for="customGoals">Autres objectifs (optionnel)</label>
            <textarea id="customGoals" placeholder="Un objectif par ligne"></textarea>
            <span class="helper-text">Si vos objectifs ne sont pas dans la liste ci-dessus</span>
          </div>

          <div class="form-group" id="narrativeStyleGroup">
            <label for="narrativeStyle">Style narratif</label>
            <select id="narrativeStyle">
              <option value="√âducatif neutre avec voix off bienveillante">√âducatif neutre</option>
              <option value="Aventure avec personnage h√©ros enfant">Aventure (h√©ros enfant)</option>
              <option value="Ludique avec mascotte animale attachante">Ludique (mascotte)</option>
              <option value="Conte interactif fa√ßon livre dont vous √™tes le h√©ros">Conte interactif</option>
              <option value="Documentaire style reportage enfant (type C'est pas sorcier)">Documentaire enfant</option>
              <option value="Jeu vid√©o √©ducatif avec niveaux progressifs">Jeu vid√©o √† niveaux</option>
              <option value="Exploration libre monde ouvert">Exploration libre</option>
            </select>
          </div>

          <div class="form-group" id="additionalContextGroup">
            <label for="additionalContext">Pr√©cisions (optionnel)</label>
            <textarea id="additionalContext" placeholder="Pr√©f√©rences, sensibilit√©s, th√®mes favoris‚Ä¶"></textarea>
          </div>
        </div>

        <!-- 5Ô∏è‚É£ INTERACTIVIT√â -->
        <div class="section">
          <h2 class="section-title">5Ô∏è‚É£ Interactivit√©</h2>
          <div class="form-group">
            <label>Types d'interactions</label>
            <div class="checkbox-group" id="interactionsBox">
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Quiz/QCM avec choix multiples"><span>Quiz/QCM</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Glisser-d√©poser (drag & drop)"><span>Glisser-d√©poser</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Colorier/Dessiner sur canvas HTML5"><span>Colorier/Dessiner</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Jeux de m√©moire (paires, memory)"><span>M√©moire</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Animations d√©clench√©es au clic"><span>Animations au clic</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Histoire √† choix multiples (embranchements)"><span>Histoire √† choix</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Puzzles et assemblage"><span>Puzzles</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Jeux de sons (associer son √† image)"><span>Jeux de sons</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Labyrinthe avec navigation clavier/tactile"><span>Labyrinthe</span></label>
              <label class="checkbox-item"><input type="checkbox" name="interactions" value="Tri et cat√©gorisation (ranger par cat√©gorie)"><span>Tri/Cat√©gories</span></label>
            </div>
          </div>

          <div class="form-group" id="rewardsGroup">
            <label>Syst√®me de r√©compenses</label>
            <div class="radio-group">
              <label class="radio-item"><input type="radio" name="rewards" value="Sons positifs + animations joyeuses" checked><span>Sons + animations</span></label>
              <label class="radio-item"><input type="radio" name="rewards" value="√âtoiles/badges visuels collectionnables"><span>√âtoiles/badges</span></label>
              <label class="radio-item"><input type="radio" name="rewards" value="Messages encourageants avec emojis"><span>Messages encourageants</span></label>
              <label class="radio-item"><input type="radio" name="rewards" value="D√©blocage progressif de contenus bonus"><span>D√©blocage de bonus</span></label>
            </div>
          </div>

          <div class="form-group" id="errorHandlingGroup">
            <label>Gestion des erreurs</label>
            <div class="radio-group">
              <label class="radio-item"><input type="radio" name="errorHandling" value="R√©essayer sans p√©nalit√© avec indices progressifs" checked><span>R√©essayer + indices</span></label>
              <label class="radio-item"><input type="radio" name="errorHandling" value="Afficher solution apr√®s 3 tentatives"><span>Solution apr√®s 3 essais</span></label>
              <label class="radio-item"><input type="radio" name="errorHandling" value="Apprentissage par l'erreur : expliquer pourquoi c'est faux"><span>Expliquer l'erreur</span></label>
              <label class="radio-item"><input type="radio" name="errorHandling" value="Jamais bloquer, toujours positif, passer √† la suite"><span>Toujours positif</span></label>
            </div>
          </div>
        </div>

        <!-- ANALYTICS -->
        <div class="section">
          <h2 class="section-title">üìä Suivi & Analytics</h2>
          <div class="form-group" id="timerGroup">
            <label>Chronom√®tre temps de jeu</label>
            <div class="radio-group">
              <label class="radio-item"><input type="radio" name="timer" value="Oui - Afficher chronom√®tre visible en permanence" checked><span>Visibile</span></label>
              <label class="radio-item"><input type="radio" name="timer" value="Oui - Chronom√®tre discret (petit coin d'√©cran)"><span>Discret</span></label>
              <label class="radio-item"><input type="radio" name="timer" value="Non - Pas de chronom√®tre (apprentissage sans pression)"><span>Pas de chrono</span></label>
            </div>
          </div>

          <div class="form-group" id="statsGroup">
            <label>Statistiques & progression</label>
            <div class="checkbox-group">
              <label class="checkbox-item"><input type="checkbox" name="stats" value="Afficher score en temps r√©el"><span>Score temps r√©el</span></label>
              <label class="checkbox-item"><input type="checkbox" name="stats" value="Barre de progression visuelle"><span>Barre progression</span></label>
              <label class="checkbox-item"><input type="checkbox" name="stats" value="Compteur r√©ussites/erreurs"><span>Succ√®s/erreurs</span></label>
              <label class="checkbox-item"><input type="checkbox" name="stats" value="R√©capitulatif d√©taill√© √† la fin"><span>R√©cap final</span></label>
              <label class="checkbox-item"><input type="checkbox" name="stats" value="Graphique d'√©volution (si plusieurs sessions)"><span>Graphique d'√©volution</span></label>
            </div>
          </div>
        </div>

        <!-- ASSISTANCE PARENTALE -->
        <div class="section">
          <h2 class="section-title">üë®‚Äçüë©‚Äçüëß Assistance Parentale</h2>
          <div class="form-group">
            <label>Conseils contextuels</label>
            <div class="radio-group">
              <label class="radio-item"><input type="radio" name="parentalGuidance" value="Oui - Panneau d'aide discret avec conseils en temps r√©el" checked><span>Panneau d'aide</span></label>
              <label class="radio-item"><input type="radio" name="parentalGuidance" value="Oui - Notifications subtiles selon r√©actions enfant"><span>Notifications</span></label>
              <label class="radio-item"><input type="radio" name="parentalGuidance" value="Non - Enfant en totale autonomie"><span>Autonomie</span></label>
            </div>
          </div>

          <div class="form-group">
            <label>Type de conseils</label>
            <div class="checkbox-group">
              <label class="checkbox-item"><input type="checkbox" name="guidanceTypes" value="Comment encourager apr√®s une erreur"><span>Encourager apr√®s erreur</span></label>
              <label class="checkbox-item"><input type="checkbox" name="guidanceTypes" value="Quand f√©liciter (timing optimal)"><span>Quand f√©liciter</span></label>
              <label class="checkbox-item"><input type="checkbox" name="guidanceTypes" value="D√©tecter frustration et comment intervenir"><span>G√©rer frustration</span></label>
              <label class="checkbox-item"><input type="checkbox" name="guidanceTypes" value="Proposer pauses si temps √©coul√© long"><span>Proposer pauses</span></label>
              <label class="checkbox-item"><input type="checkbox" name="guidanceTypes" value="Identifier points forts et axes d'am√©lioration"><span>Forces & axes</span></label>
              <label class="checkbox-item"><input type="checkbox" name="guidanceTypes" value="Questions de discussion post-activit√©"><span>Questions discussion</span></label>
            </div>
          </div>
        </div>

        <!-- DESIGN -->
        <div class="section">
          <h2 class="section-title">üé® Design et Couleurs</h2>
          <div class="form-group" id="colorPaletteGroup">
            <label class="required">Palette de couleurs</label>
            <div style="display:flex;flex-direction:column;gap:12px;">
              <label class="color-palette">
                <input type="radio" name="colorPalette" value="Pastel Doux (#FFE4E1, #E0F2F7, #FFF9C4, #D1F2EB)" checked>
                <div style="display:flex;gap:5px;">
                  <div class="color-swatch" style="background:#FFE4E1"></div>
                  <div class="color-swatch" style="background:#E0F2F7"></div>
                  <div class="color-swatch" style="background:#FFF9C4"></div>
                  <div class="color-swatch" style="background:#D1F2EB"></div>
                </div>
                <span class="palette-name">Pastel Doux</span>
              </label>
              <label class="color-palette">
                <input type="radio" name="colorPalette" value="Oc√©an Calme (#B3E5FC, #81D4FA, #4FC3F7, #29B6F6)">
                <div style="display:flex;gap:5px;">
                  <div class="color-swatch" style="background:#B3E5FC"></div>
                  <div class="color-swatch" style="background:#81D4FA"></div>
                  <div class="color-swatch" style="background:#4FC3F7"></div>
                  <div class="color-swatch" style="background:#29B6F6"></div>
                </div>
                <span class="palette-name">Oc√©an Calme</span>
              </label>
              <label class="color-palette">
                <input type="radio" name="colorPalette" value="For√™t Enchant√©e (#C8E6C9, #A5D6A7, #81C784, #66BB6A)">
                <div style="display:flex;gap:5px;">
                  <div class="color-swatch" style="background:#C8E6C9"></div>
                  <div class="color-swatch" style="background:#A5D6A7"></div>
                  <div class="color-swatch" style="background:#81C784"></div>
                  <div class="color-swatch" style="background:#66BB6A"></div>
                </div>
                <span class="palette-name">For√™t Enchant√©e</span>
              </label>
              <label class="color-palette">
                <input type="radio" name="colorPalette" value="Neutre Moderne (#F5F5F5, #E0E0E0, #BDBDBD, #9E9E9E)">
                <div style="display:flex;gap:5px;">
                  <div class="color-swatch" style="background:#F5F5F5"></div>
                  <div class="color-swatch" style="background:#E0E0E0"></div>
                  <div class="color-swatch" style="background:#BDBDBD"></div>
                  <div class="color-swatch" style="background:#9E9E9E"></div>
                </div>
                <span class="palette-name">Neutre Moderne</span>
              </label>
              <label class="color-palette">
                <input type="radio" name="colorPalette" value="Arc-en-ciel Doux (#FFE0B2, #FFF9C4, #C8E6C9, #B3E5FC, #E1BEE7)">
                <div style="display:flex;gap:5px;">
                  <div class="color-swatch" style="background:#FFE0B2"></div>
                  <div class="color-swatch" style="background:#FFF9C4"></div>
                  <div class="color-swatch" style="background:#C8E6C9"></div>
                  <div class="color-swatch" style="background:#B3E5FC"></div>
                  <div class="color-swatch" style="background:#E1BEE7"></div>
                </div>
                <span class="palette-name">Arc-en-ciel Doux</span>
              </label>
            </div>
          </div>
        </div>

        <!-- ACCESSIBILIT√â -->
        <div class="section">
          <h2 class="section-title">‚ôø Accessibilit√©</h2>
          <div class="info-banner">Responsive + WCAG 2.1 AA minimum par d√©faut.</div>
          <div class="form-group">
            <label>Options</label>
            <div class="checkbox-group">
              <label class="checkbox-item"><input type="checkbox" name="accessibility" value="Support mobilit√© r√©duite (gros boutons 60x60px, espacement large)"><span>Gros boutons</span></label>
              <label class="checkbox-item"><input type="checkbox" name="accessibility" value="Navigation compl√®te au clavier (Tab/Fl√®ches/Enter/Espace)"><span>Clavier complet</span></label>
              <label class="checkbox-item"><input type="checkbox" name="accessibility" value="Support lecteurs d'√©cran (NVDA, VoiceOver, JAWS)"><span>Lecteurs d'√©cran</span></label>
              <label class="checkbox-item"><input type="checkbox" name="accessibility" value="Contrastes renforc√©s WCAG AAA (ratio 7:1)"><span>Contraste AAA</span></label>
              <label class="checkbox-item"><input type="checkbox" name="accessibility" value="Police dyslexie-friendly (OpenDyslexic ou √©quivalent)"><span>Police dyslexie</span></label>
              <label class="checkbox-item"><input type="checkbox" name="accessibility" value="Mode sombre/clair commutable"><span>Mode sombre/clair</span></label>
            </div>
          </div>
        </div>

        <!-- BOUTONS -->
        <div class="button-group">
          <button type="button" onclick="openHistoryModal()" class="btn-secondary" style="flex:0;">
            üìö Historique
          </button>
          <button type="button" onclick="openImportModal()" class="btn-secondary" style="flex:0;">
            üì• Importer
          </button>
          <button type="button" onclick="exportConfig()" class="btn-secondary" style="flex:0;">
            üíæ Exporter Config
          </button>
          <button type="submit" id="submitBtn" class="btn-primary">
            <span class="spinner"></span><span>üöÄ G√©n√©rer le Prompt</span>
          </button>
          <button type="reset" class="btn-secondary">üîÑ R√©initialiser</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ===== VERSION & CONFIG =====
    const VERSION = "v1.015";
    const STORAGE_KEY_NAME = 'prompt_generator_creator_name';
    const STORAGE_KEY_HISTORY = 'prompt_generator_history';
    const MAX_HISTORY = 10;
    let currentFormat = 'json';
    let testModeEnabled = true;

    // ===== HISTORY MANAGER =====
    class HistoryManager {
      constructor() {
        this.history = this.load();
      }

      load() {
        try {
          const data = localStorage.getItem(STORAGE_KEY_HISTORY);
          return data ? JSON.parse(data) : [];
        } catch(e) {
          console.error('Erreur chargement historique:', e);
          return [];
        }
      }

      save() {
        try {
          localStorage.setItem(STORAGE_KEY_HISTORY, JSON.stringify(this.history));
        } catch(e) {
          console.error('Erreur sauvegarde historique:', e);
        }
      }

      add(config, prompt) {
        const entry = {
          id: Date.now(),
          timestamp: new Date().toISOString(),
          config: config,
          prompt: prompt,
          preview: {
            theme: config.content.theme,
            type: config.content.type,
            creator: config.metadata.creator
          }
        };
        
        this.history.unshift(entry);
        if(this.history.length > MAX_HISTORY) {
          this.history = this.history.slice(0, MAX_HISTORY);
        }
        this.save();
        return entry;
      }

      get(id) {
        return this.history.find(h => h.id === id);
      }

      delete(id) {
        this.history = this.history.filter(h => h.id !== id);
        this.save();
      }

      clear() {
        this.history = [];
        this.save();
      }

      getAll() {
        return this.history;
      }
    }

    const historyManager = new HistoryManager();

    // ===== MATRICE DE PERTINENCE =====
    const FIELD_RELEVANCE = {
      histoire: { timerGroup: false, statsGroup: false },
      jeu_educatif: {},
      encyclopedie: { timerGroup: false, statsGroup: false },
      exercice: {},
      lecon_vie: { timerGroup: false, statsGroup: false },
      quiz: {},
      coloriage: { errorHandlingGroup: false, timerGroup: false },
      puzzle: {},
      memoire: {},
      aventure_choix: { timerGroup: false },
      labyrinthe: {},
      tri_categorie: {}
    };

    const TOOLTIP_MESSAGES = {
      timerGroup: "‚è±Ô∏è Chronom√®tre non pertinent pour ce type de contenu",
      statsGroup: "üìä Statistiques non recommand√©es pour ce type",
      errorHandlingGroup: "‚ùå Gestion d'erreur non applicable"
    };

    // ===== PRESETS PAR TYPE =====
    const PRESETS = {
      histoire: {
        narrativeStyle: "Conte interactif fa√ßon livre dont vous √™tes le h√©ros",
        goals: ["Reconnaissance et gestion des √©motions","Partage et coop√©ration"],
        interactions: ["Histoire √† choix multiples (embranchements)","Animations d√©clench√©es au clic"]
      },
      jeu_educatif: {
        narrativeStyle: "Jeu vid√©o √©ducatif avec niveaux progressifs",
        goals: ["S√©quences et suites logiques","Comptage et d√©nombrement 1-20"],
        interactions: ["Quiz/QCM avec choix multiples","Glisser-d√©poser (drag & drop)","Puzzles et assemblage"]
      },
      encyclopedie: {
        narrativeStyle: "Documentaire style reportage enfant (type C'est pas sorcier)",
        goals: ["Reconnaissance alphabet majuscules","Parties du corps humain"],
        interactions: ["Quiz/QCM avec choix multiples","Animations d√©clench√©es au clic"]
      },
      exercice: {
        narrativeStyle: "√âducatif neutre avec voix off bienveillante",
        goals: ["Comptage et d√©nombrement 1-10","S√©quences et suites logiques"],
        interactions: ["Quiz/QCM avec choix multiples","Puzzles et assemblage"]
      },
      lecon_vie: {
        narrativeStyle: "Ludique avec mascotte animale attachante",
        goals: ["Partage et coop√©ration","Reconnaissance et gestion des √©motions"],
        interactions: ["Histoire √† choix multiples (embranchements)","Animations d√©clench√©es au clic"]
      },
      quiz: {
        narrativeStyle: "√âducatif neutre avec voix off bienveillante",
        goals: ["Reconnaissance alphabet majuscules","Comptage et d√©nombrement 1-10"],
        interactions: ["Quiz/QCM avec choix multiples"]
      },
      coloriage: {
        narrativeStyle: "Ludique avec mascotte animale attachante",
        goals: ["Reconnaissance couleurs primaires (rouge, bleu, jaune)","Identification formes g√©om√©triques 2D (carr√©, cercle, triangle)"],
        interactions: ["Colorier/Dessiner sur canvas HTML5","Animations d√©clench√©es au clic"]
      },
      puzzle: {
        narrativeStyle: "Exploration libre monde ouvert",
        goals: ["S√©quences et suites logiques"],
        interactions: ["Puzzles et assemblage","Glisser-d√©poser (drag & drop)"]
      },
      memoire: {
        narrativeStyle: "Ludique avec mascotte animale attachante",
        goals: ["M√©moire visuelle (se souvenir d'images)","Reconnaissance et gestion des √©motions"],
        interactions: ["Jeux de m√©moire (paires, memory)","Jeux de sons (associer son √† image)"]
      },
      aventure_choix: {
        narrativeStyle: "Conte interactif fa√ßon livre dont vous √™tes le h√©ros",
        goals: ["Partage et coop√©ration","S√©quences et suites logiques"],
        interactions: ["Histoire √† choix multiples (embranchements)","Animations d√©clench√©es au clic"]
      },
      labyrinthe: {
        narrativeStyle: "Exploration libre monde ouvert",
        goals: ["Orientation spatiale (gauche/droite, avant/arri√®re)","S√©quences et suites logiques"],
        interactions: ["Labyrinthe avec navigation clavier/tactile","Animations d√©clench√©es au clic"]
      },
      tri_categorie: {
        narrativeStyle: "√âducatif neutre avec voix off bienveillante",
        goals: ["S√©quences et suites logiques","Reconnaissance couleurs primaires (rouge, bleu, jaune)"],
        interactions: ["Tri et cat√©gorisation (ranger par cat√©gorie)","Glisser-d√©poser (drag & drop)"]
      }
    };

    // ===== INITIALISATION =====
    window.addEventListener('DOMContentLoaded', function(){
      document.getElementById('creationDate').value = new Date().toLocaleDateString('fr-FR',{year:'numeric',month:'long',day:'numeric'});
      const savedName = localStorage.getItem(STORAGE_KEY_NAME);
      if(savedName){ document.getElementById('creatorName').value = savedName; }
      initFormatSelector();
      attachLivePreview();
      initGoalsAccordion();
      initGoalsSearch();
      updateJsonPreview();
      
      document.getElementById('testMode').addEventListener('change', function(){
        testModeEnabled = this.checked;
        updateJsonPreview();
        console.log(`üß™ Mode test ${testModeEnabled ? 'ACTIV√â (local)' : 'D√âSACTIV√â (CDN)'}`);
      });
      
      document.getElementById('applyPresetBtn').addEventListener('click', applyPreset);
      document.getElementById('clearSelectionsBtn').addEventListener('click', clearSelections);
      document.getElementById('contentType').addEventListener('change', function() {
        if (this.value && PRESETS[this.value]) {
            updateFieldVisibility(this.value);
        }
      });

      // Import file handler
      document.getElementById('importFileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if(file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            try {
              const config = JSON.parse(event.target.result);
              loadConfig(config);
              closeImportModal();
              alert('‚úÖ Configuration import√©e avec succ√®s !');
            } catch(err) {
              alert('‚ùå Erreur : fichier JSON invalide');
            }
          };
          reader.readAsText(file);
        }
      });
    });

    function initFormatSelector(){
      const options = document.querySelectorAll('.format-option');
      options.forEach(opt=>{
        opt.addEventListener('click',function(){
          options.forEach(o=>o.classList.remove('active'));
          this.classList.add('active');
          currentFormat = this.dataset.format;
          const box = document.getElementById('jsonPreview');
          if(currentFormat==='json'){ box.style.display='block'; updateJsonPreview(); }
          else{ box.style.display='none'; }
        });
      });
    }

    function attachLivePreview(){
      document.querySelectorAll('input,select,textarea').forEach(el=>{
        el.addEventListener('change',updateJsonPreview);
        el.addEventListener('input',updateJsonPreview);
      });
      document.getElementById('creatorName').addEventListener('blur',function(){
        const name = this.value.trim(); 
        if(name && name.length <= 100){ 
          localStorage.setItem(STORAGE_KEY_NAME,name); 
        }
        updateJsonPreview();
      });
    }

    // ===== ACCORDION OBJECTIFS =====
    function initGoalsAccordion(){
      const toggles = document.querySelectorAll('.category-toggle');
      toggles.forEach(toggle => {
        toggle.addEventListener('click', function(){
          const content = this.nextElementSibling;
          const wasActive = this.classList.contains('active');
          
          toggles.forEach(t => {
            t.classList.remove('active');
            t.nextElementSibling.classList.remove('expanded');
          });
          
          if(!wasActive){
            this.classList.add('active');
            content.classList.add('expanded');
          }
        });
      });

      document.querySelectorAll('input[name="pedGoals"]').forEach(cb => {
        cb.addEventListener('change', updateGoalsCount);
      });
      updateGoalsCount();
    }

    function updateGoalsCount(){
      const categories = document.querySelectorAll('.category');
      let totalSelected = 0;

      categories.forEach(cat => {
        const checkboxes = cat.querySelectorAll('input[name="pedGoals"]');
        const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
        const total = checkboxes.length;
        const counter = cat.querySelector('.count');
        if(counter){
          counter.textContent = `(${checked}/${total})`;
        }
        totalSelected += checked;
      });

      document.getElementById('selectedCount').textContent = totalSelected;
      updateJsonPreview();
    }

    // ===== RECHERCHE OBJECTIFS =====
    function initGoalsSearch(){
      const searchInput = document.getElementById('searchGoals');
      searchInput.addEventListener('input', function(){
        const query = this.value.toLowerCase().trim();
        const categories = document.querySelectorAll('.category');
        
        if(!query){
          categories.forEach(cat => {
            cat.style.display = 'block';
            cat.querySelectorAll('.checkbox-item').forEach(item => {
              item.style.display = 'flex';
            });
          });
          return;
        }

        categories.forEach(cat => {
          const items = cat.querySelectorAll('.checkbox-item');
          let hasVisible = false;
          
          items.forEach(item => {
            const text = item.textContent.toLowerCase();
            if(text.includes(query)){
              item.style.display = 'flex';
              hasVisible = true;
            } else {
              item.style.display = 'none';
            }
          });

          cat.style.display = hasVisible ? 'block' : 'none';
          if(hasVisible){
            const toggle = cat.querySelector('.category-toggle');
            const content = cat.querySelector('.category-content');
            toggle.classList.add('active');
            content.classList.add('expanded');
          }
        });
      });
    }

    // ===== GRISER CHAMPS =====
    function updateFieldVisibility(contentType) {
        document.querySelectorAll('.form-group').forEach(group => {
            group.classList.remove('disabled-field');
            const existingTooltip = group.querySelector('.disabled-tooltip');
            if (existingTooltip) {
                existingTooltip.remove();
            }
            group.querySelectorAll('input, select, textarea').forEach(field => {
                field.disabled = false;
            });
        });

        if (!contentType || !FIELD_RELEVANCE[contentType]) return;

        const relevance = FIELD_RELEVANCE[contentType];
        Object.keys(relevance).forEach(fieldGroup => {
            if (relevance[fieldGroup] === false) {
                const group = document.getElementById(fieldGroup);
                if (group) {
                    group.classList.add('disabled-field');
                    const tooltip = document.createElement('div');
                    tooltip.className = 'disabled-tooltip';
                    tooltip.innerHTML = `
                        <span class="disabled-icon">üîí</span>
                        <div class="disabled-tooltip-text">${TOOLTIP_MESSAGES[fieldGroup] || 'Champ non pertinent'}</div>
                    `;
                    group.appendChild(tooltip);
                    group.querySelectorAll('input, select, textarea').forEach(field => {
                        field.disabled = true;
                    });
                }
            }
        });
    }

    // ===== PRESET HELPERS =====
    function setSelectValue(id, value){
      const sel = document.getElementById(id);
      if(!sel) return;
      const exists = Array.from(sel.options).some(o=>o.value===value);
      if(exists){ sel.value = value; }
    }
    
    function clearSelections(){
      document.querySelectorAll('.form-group').forEach(group => {
          group.classList.remove('disabled-field');
          const existingTooltip = group.querySelector('.disabled-tooltip');
          if (existingTooltip) {
              existingTooltip.remove();
          }
          group.querySelectorAll('input, select, textarea').forEach(field => {
              field.disabled = false;
          });
      });
      
      document.querySelectorAll('#interactionsBox input[type="checkbox"]').forEach(i=>i.checked=false);
      document.querySelectorAll('input[name="pedGoals"]').forEach(i=>i.checked=false);
      updateGoalsCount();
      document.getElementById('presetHint').textContent = 'S√©lections nettoy√©es.';
      updateJsonPreview();
    }
    
    function applyPreset(){
      const type = document.getElementById('contentType').value;
      if(!type || !PRESETS[type]){ 
        document.getElementById('presetHint').textContent='S√©lectionnez un type valide.'; 
        return; 
      }
      
      const p = PRESETS[type];
      setSelectValue('narrativeStyle', p.narrativeStyle);
      
      document.querySelectorAll('input[name="pedGoals"]').forEach(i=>i.checked=false);
      document.querySelectorAll('input[name="pedGoals"]').forEach(i=>{
        if(p.goals.includes(i.value)) i.checked = true;
      });
      
      document.querySelectorAll('#interactionsBox input[type="checkbox"]').forEach(i=>i.checked=false);
      document.querySelectorAll('#interactionsBox input[type="checkbox"]').forEach(i=>{
        if(p.interactions.includes(i.value)) i.checked = true;
      });
      
      updateFieldVisibility(type);
      updateGoalsCount();
      document.getElementById('presetHint').textContent = '‚úÖ Preset appliqu√© : ' + type.replace('_',' ');
      updateJsonPreview();
    }

    // ===== BUILD CONFIG OBJECT =====
    function buildConfigObject() {
      const creatorName = document.getElementById('creatorName').value.trim();
      const testMode = document.getElementById('testMode').checked;
      const contentType = document.getElementById('contentType').value;
      
      const pedGoals = Array.from(document.querySelectorAll('input[name="pedGoals"]:checked')).map(cb=>cb.value);
      const customGoals = (document.getElementById('customGoals').value||'').trim();
      let allGoals = [...pedGoals];
      if(customGoals){
        allGoals = [...allGoals, ...customGoals.split('\n').map(s=>s.trim()).filter(Boolean)];
      }

      return {
        metadata: { 
          creator: creatorName,
          projectVersion: document.getElementById('projectVersion').value,
          creationDate: document.getElementById('creationDate').value,
          generator: `Formulaire ${VERSION}`,
          testMode
        },
        targetAudience: { 
          ageRanges: getCheckedValues('ageRange'),
          readingLevel: (document.querySelector('input[name="readingLevel"]:checked')||{}).value,
          supervision: (document.querySelector('input[name="supervision"]:checked')||{}).value
        },
        language: { 
          languages: getCheckedValues('languages'),
          layout: (document.querySelector('input[name="languageLayout"]:checked')||{}).value
        },
        content: {
          type: contentType,
          theme: document.getElementById('theme').value,
          narrativeStyle: document.getElementById('narrativeStyle').value,
          educationalGoals: allGoals,
          additionalContext: (document.getElementById('additionalContext').value||'').trim() || undefined
        },
        interactivity: { 
          interactionTypes: getCheckedValues('interactions'),
          rewardSystem: (document.querySelector('input[name="rewards"]:checked')||{}).value,
          errorHandling: (document.querySelector('input[name="errorHandling"]:checked')||{}).value
        },
        analytics: { 
          timer: (document.querySelector('input[name="timer"]:checked')||{}).value,
          statistics: getCheckedValues('stats')
        },
        parentalAssistance: { 
          guidanceType: (document.querySelector('input[name="parentalGuidance"]:checked')||{}).value,
          guidanceTopics: getCheckedValues('guidanceTypes')
        },
        design: { 
          colorPalette: (document.querySelector('input[name="colorPalette"]:checked')||{}).value
        },
        accessibility: { 
          features: getCheckedValues('accessibility')
        }
      };
    }

    // ===== LOAD CONFIG =====
    function loadConfig(config) {
      // Metadata
      if(config.metadata) {
        if(config.metadata.creator) document.getElementById('creatorName').value = config.metadata.creator;
        if(config.metadata.projectVersion) document.getElementById('projectVersion').value = config.metadata.projectVersion;
        if(config.metadata.testMode !== undefined) {
          document.getElementById('testMode').checked = config.metadata.testMode;
          testModeEnabled = config.metadata.testMode;
        }
      }

      // Target audience
      if(config.targetAudience) {
        document.querySelectorAll('input[name="ageRange"]').forEach(cb => {
          cb.checked = config.targetAudience.ageRanges && config.targetAudience.ageRanges.includes(cb.value);
        });
        if(config.targetAudience.readingLevel) {
          const radio = document.querySelector(`input[name="readingLevel"][value="${config.targetAudience.readingLevel}"]`);
          if(radio) radio.checked = true;
        }
        if(config.targetAudience.supervision) {
          const radio = document.querySelector(`input[name="supervision"][value="${config.targetAudience.supervision}"]`);
          if(radio) radio.checked = true;
        }
      }

      // Language
      if(config.language) {
        document.querySelectorAll('input[name="languages"]').forEach(cb => {
          cb.checked = config.language.languages && config.language.languages.includes(cb.value);
        });
        if(config.language.layout) {
          const radio = document.querySelector(`input[name="languageLayout"][value="${config.language.layout}"]`);
          if(radio) radio.checked = true;
        }
      }

      // Content
      if(config.content) {
        if(config.content.type) document.getElementById('contentType').value = config.content.type;
        if(config.content.theme) document.getElementById('theme').value = config.content.theme;
        if(config.content.narrativeStyle) document.getElementById('narrativeStyle').value = config.content.narrativeStyle;
        if(config.content.additionalContext) document.getElementById('additionalContext').value = config.content.additionalContext;
        
        if(config.content.educationalGoals) {
          document.querySelectorAll('input[name="pedGoals"]').forEach(cb => {
            cb.checked = config.content.educationalGoals.includes(cb.value);
          });
        }
      }

      // Interactivity
      if(config.interactivity) {
        document.querySelectorAll('input[name="interactions"]').forEach(cb => {
          cb.checked = config.interactivity.interactionTypes && config.interactivity.interactionTypes.includes(cb.value);
        });
        if(config.interactivity.rewardSystem) {
          const radio = document.querySelector(`input[name="rewards"][value="${config.interactivity.rewardSystem}"]`);
          if(radio) radio.checked = true;
        }
        if(config.interactivity.errorHandling) {
          const radio = document.querySelector(`input[name="errorHandling"][value="${config.interactivity.errorHandling}"]`);
          if(radio) radio.checked = true;
        }
      }

      // Analytics
      if(config.analytics) {
        if(config.analytics.timer) {
          const radio = document.querySelector(`input[name="timer"][value="${config.analytics.timer}"]`);
          if(radio) radio.checked = true;
        }
        document.querySelectorAll('input[name="stats"]').forEach(cb => {
          cb.checked = config.analytics.statistics && config.analytics.statistics.includes(cb.value);
        });
      }

      // Parental assistance
      if(config.parentalAssistance) {
        if(config.parentalAssistance.guidanceType) {
          const radio = document.querySelector(`input[name="parentalGuidance"][value="${config.parentalAssistance.guidanceType}"]`);
          if(radio) radio.checked = true;
        }
        document.querySelectorAll('input[name="guidanceTypes"]').forEach(cb => {
          cb.checked = config.parentalAssistance.guidanceTopics && config.parentalAssistance.guidanceTopics.includes(cb.value);
        });
      }

      // Design
      if(config.design && config.design.colorPalette) {
        const radio = document.querySelector(`input[name="colorPalette"][value="${config.design.colorPalette}"]`);
        if(radio) radio.checked = true;
      }

      // Accessibility
      if(config.accessibility) {
        document.querySelectorAll('input[name="accessibility"]').forEach(cb => {
          cb.checked = config.accessibility.features && config.accessibility.features.includes(cb.value);
        });
      }

      updateGoalsCount();
      updateJsonPreview();
    }

    // ===== EXPORT CONFIG =====
    function exportConfig() {
      const config = buildConfigObject();
      const blob = new Blob([JSON.stringify(config, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const theme = (document.getElementById('theme').value||'config').replace(/[^a-z0-9]/gi,'_').toLowerCase();
      const ts = new Date().toISOString().slice(0,10);
      a.href = url;
      a.download = `config_${theme}_${ts}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      alert('‚úÖ Configuration export√©e avec succ√®s !');
    }

    // ===== HISTORY FUNCTIONS =====
    function openHistoryModal() {
      renderHistoryList();
      document.getElementById('historyModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeHistoryModal() {
      document.getElementById('historyModal').classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    function openImportModal() {
      document.getElementById('importModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeImportModal() {
      document.getElementById('importModal').classList.remove('active');
      document.body.style.overflow = 'auto';
      document.getElementById('importFileInput').value = '';
    }

    function renderHistoryList() {
      const container = document.getElementById('historyList');
      const history = historyManager.getAll();

      if(history.length === 0) {
        container.innerHTML = `
          <div class="empty-history">
            <div class="empty-history-icon">üì≠</div>
            <p>Aucun prompt dans l'historique</p>
            <p class="helper-text">G√©n√©rez votre premier prompt pour le voir appara√Ætre ici !</p>
          </div>
        `;
        return;
      }

      container.innerHTML = history.map(entry => {
        const date = new Date(entry.timestamp);
        const dateStr = date.toLocaleDateString('fr-FR', {day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'});
        
        return `
          <div class="history-item">
            <div class="history-header">
              <div class="history-title">${entry.preview.theme || 'Sans titre'}</div>
              <div class="history-date">${dateStr}</div>
            </div>
            <div class="history-meta">
              <span>üìÅ ${entry.preview.type || 'N/A'}</span>
              <span>üë§ ${entry.preview.creator || 'Anonyme'}</span>
            </div>
            <div class="history-actions">
              <button class="btn-primary btn-small" onclick="loadFromHistory(${entry.id})">
                üîÑ Charger
              </button>
              <button class="btn-secondary btn-small" onclick="viewPromptFromHistory(${entry.id})">
                üëÅÔ∏è Voir prompt
              </button>
              <button class="btn-danger btn-small" onclick="if(confirm('Supprimer cet historique ?')) { historyManager.delete(${entry.id}); renderHistoryList(); }">
                üóëÔ∏è
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function loadFromHistory(id) {
      const entry = historyManager.get(id);
      if(!entry) {
        alert('‚ùå Entr√©e introuvable');
        return;
      }
      loadConfig(entry.config);
      closeHistoryModal();
      alert('‚úÖ Configuration charg√©e depuis l\'historique !');
    }

    function viewPromptFromHistory(id) {
      const entry = historyManager.get(id);
      if(!entry) {
        alert('‚ùå Entr√©e introuvable');
        return;
      }
      document.getElementById('promptOutputModal').textContent = entry.prompt;
      closeHistoryModal();
      openResultModal();
    }

    // ===== JSON PREVIEW =====
    function syntaxHighlight(json){
      json = json.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (m){
        let cls = 'json-number';
        if(/^"/.test(m)){ cls = (/:$/.test(m)) ? 'json-key' : 'json-string'; }
        else if(/true|false/.test(m)){ cls = 'json-boolean'; }
        else if(/null/.test(m)){ cls = 'json-null'; }
        return '<span class="'+cls+'">'+m+'</span>';
      });
    }

    function getCheckedValues(name){
      return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(cb=>cb.value);
    }

    function updateJsonPreview(){
      if(currentFormat!=='json') return;

      const creatorName = (document.getElementById('creatorName').value||'').trim() || "Votre nom";
      const theme = (document.getElementById('theme').value||'').trim() || "Th√®me du projet";
      const contentType = document.getElementById('contentType').value || "non d√©fini";
      const testMode = document.getElementById('testMode').checked;

      const config = buildConfigObject();
      document.getElementById('jsonPreview').innerHTML = syntaxHighlight(JSON.stringify(config,null,2));
    }

    // ===== MODALS =====
    function openHelpModal(){ document.getElementById('helpModal').classList.add('active'); document.body.style.overflow='hidden'; }
    function closeHelpModal(){ document.getElementById('helpModal').classList.remove('active'); document.body.style.overflow='auto'; }
    function openResultModal(){ document.getElementById('resultModal').classList.add('active'); document.body.style.overflow='hidden'; }
    function closeResultModal(){ document.getElementById('resultModal').classList.remove('active'); document.body.style.overflow='auto'; }
    document.getElementById('helpModal').addEventListener('click',e=>{ if(e.target===e.currentTarget) closeHelpModal(); });
    document.getElementById('resultModal').addEventListener('click',e=>{ if(e.target===e.currentTarget) closeResultModal(); });
    document.getElementById('historyModal').addEventListener('click',e=>{ if(e.target===e.currentTarget) closeHistoryModal(); });
    document.getElementById('importModal').addEventListener('click',e=>{ if(e.target===e.currentTarget) closeImportModal(); });

    // ===== VALIDATION =====
    function clearErrors(){ document.querySelectorAll('.form-group.has-error').forEach(g=>g.classList.remove('has-error')); }
    function showError(groupId, message){
      const g = document.getElementById(groupId); if(!g) return;
      g.classList.add('has-error');
      const e = g.querySelector('.error-message'); if(e && message) e.textContent = '‚ùå ' + message;
    }
    function validateForm(){
      clearErrors(); let ok = true; let first = null;
      const creatorName = document.getElementById('creatorName').value.trim();
      if(!creatorName || creatorName.length > 100){ 
        const grp = document.querySelector('#creatorName').closest('.form-group'); 
        grp.classList.add('has-error'); 
        ok=false; 
        first=first||grp; 
      }
      if(!(document.getElementById('contentType').value)){ showError('contentTypeGroup','Choisissez un type'); ok=false; first=first||document.getElementById('contentTypeGroup'); }
      if(document.querySelectorAll('input[name="ageRange"]:checked').length===0){ showError('ageGroup','Au moins une tranche d\'√¢ge'); ok=false; first=first||document.getElementById('ageGroup'); }
      if(!document.querySelector('input[name="readingLevel"]:checked')){ showError('readingGroup','Niveau de lecture requis'); ok=false; first=first||document.getElementById('readingGroup'); }
      const theme = document.getElementById('theme').value.trim();
      if(!theme){ showError('themeGroup','D√©crivez le sujet'); ok=false; first=first||document.getElementById('themeGroup'); }
      const goalsChecked = document.querySelectorAll('input[name="pedGoals"]:checked').length;
      const customGoals = document.getElementById('customGoals').value.trim();
      if(goalsChecked===0 && !customGoals){ showError('goalsGroup','Choisir au moins un objectif'); ok=false; first=first||document.getElementById('goalsGroup'); }
      if(!ok && first){ first.scrollIntoView({behavior:'smooth',block:'center'}); }
      return ok;
    }

    // ===== SUBMIT =====
    document.getElementById('promptForm').addEventListener('submit',function(e){
      e.preventDefault();
      if(!validateForm()) return;
      const btn = document.getElementById('submitBtn');
      btn.classList.add('loading'); btn.disabled = true;
      setTimeout(()=>{ 
        const config = buildConfigObject();
        const prompt = generateJsonPrompt(config);
        historyManager.add(config, prompt);
        btn.classList.remove('loading'); 
        btn.disabled=false; 
      }, 500);
    });

    // ===== RESET =====
    document.getElementById('promptForm').addEventListener('reset', function(){
      setTimeout(()=>{
        clearErrors();
        document.getElementById('creationDate').value = new Date().toLocaleDateString('fr-FR',{year:'numeric',month:'long',day:'numeric'});
        const savedName = localStorage.getItem(STORAGE_KEY_NAME);
        if(savedName){ document.getElementById('creatorName').value = savedName; }
        document.getElementById('presetHint').textContent = '';
        document.getElementById('testMode').checked = true;
        testModeEnabled = true;
        document.querySelectorAll('.form-group').forEach(group => {
            group.classList.remove('disabled-field');
            const existingTooltip = group.querySelector('.disabled-tooltip');
            if (existingTooltip) {
                existingTooltip.remove();
            }
            group.querySelectorAll('input, select, textarea').forEach(field => {
                field.disabled = false;
            });
        });
        updateGoalsCount();
        updateJsonPreview();
      },100);
    });

    // ===== GENERATION =====
    function generateJsonPrompt(config){
      const creatorName = config.metadata.creator;
      const projectVersion = config.metadata.projectVersion;
      const testMode = config.metadata.testMode;
      localStorage.setItem(STORAGE_KEY_NAME, creatorName);

      const presetUsed = PRESETS[config.content.type] ? {
        narrativeStyle: PRESETS[config.content.type].narrativeStyle,
        goals: PRESETS[config.content.type].goals,
        interactions: PRESETS[config.content.type].interactions
      } : null;

      const promptData = {
        ...config,
        technicalRequirements: {
          format: "HTML5 standalone",
          fileSize: "< 350 KB",
          responsive: true,
          offline: true,
          compatibility: ["Chrome 90+","Firefox 88+","Safari 14+","Edge 90+"],
          accessibility: "WCAG 2.1 AA minimum"
        },
        security: {
          noExternalLinks: true,
          noTracking: true,
          noPersonalData: true,
          noAds: true,
          gdprCompliant: true
        },
        workflow: {
          step1: "Analyze this JSON specification",
          step2: "Propose small plan in TXT format",
          step3: "generating HTML"          
        },
        blueprint: presetUsed
      };

      const prompt =
`# üéØ PROMPT CR√âATION CONTENU HTML INTERACTIF ENFANT - FORMAT JSON

## OBJECTIF
Cr√©er un contenu p√©dagogique interactif pour **dznet1.com**, totalement **responsive**, **accessible**, **SEO**, compatible **PC/Mobile** (sans d√©bordement), avec **zone publicitaire**.

${testMode ? `
‚ö†Ô∏è **MODE TEST ACTIV√â** ‚ö†Ô∏è
- Chemins m√©dias : /images/ et /audio/ (locaux) pour test PC
- Structure attendue : dossier /images/ et /audio/ √† c√¥t√© du HTML
- Fallback automatique : si m√©dia introuvable ‚Üí affiche le nom du fichier
  Exemple: <img src="images/ALGER.jpg" alt="ALGER.jpg" onerror="this.outerHTML='<span>‚ùå ALGER.jpg</span>'">
- Pour audio : <audio src="audio/exemple.wav" onerror="this.outerHTML='<span>üîá exemple.wav</span>'"></audio>
- G√©n√®re un tableau de m√©dias attendus (sans HTML) : √âl√©ment | FR | EN | AR | Image | Audio FR | Audio EN | Audio AR
` : `
üåê **MODE PRODUCTION**
- Utiliser les CDN distants (https://dznet1.com/cdn-cgi/image/...)
- Nommage: YYYYMMDD_nom_simplifie.ext
`}

## EXIGENCES
- SEO : 1 H1, H2/H3 hi√©rarchis√©s, meta-description 150‚Äì160c, mots-cl√©s naturels, CTA final
- Logo (sticky) : https://dznet1.com/images/logo.png
- Titre/H1 suffixe : ¬´ {Titre} ‚Äî Cat√©gorie : {Categorie} ‚Äî √Çge : {Age}+ ¬ª
- Metas :
  <meta name="content-category" content="{Categorie}">
  <meta name="content-age" content="{Age}">
- JSON-LD :
  "educationalUse": "{Categorie}",
  "typicalAgeRange": "{Age}+"

### Publicit√© (apr√®s header)
<div class="ad-banner">
  <img src="https://dznet1.com/cdn-cgi/image/width=500,quality=85,format=auto/https://raw.githubusercontent.com/lynx98b/dznet1/main/intranet/PUB/PUB01.png" alt="Publicit√© partenaire" />
</div>

### Footer distant
<div id="footer-placeholder"></div>
<script>
fetch("https://dznet1.com/intranet/footer.html").then(r=>r.text()).then(h=>{document.getElementById("footer-placeholder").innerHTML=h}).catch(()=>{});
</script>

${testMode ? `
### Gestion d'erreur m√©dia (MODE TEST)
Ajouter ce script global AVANT le </body> :

<script>
// Fallback global pour images
document.querySelectorAll('img').forEach(img => {
  img.onerror = function() {
    const filename = this.src.split('/').pop();
    this.outerHTML = '<span class="media-fallback">‚ùå ' + filename + '</span>';
  };
});

// Fallback global pour audio
document.querySelectorAll('audio').forEach(audio => {
  audio.addEventListener('error', function() {
    const filename = this.src.split('/').pop();
    this.outerHTML = '<span class="media-fallback">üîá ' + filename + '</span>';
  });
});
</script>

<style>
.media-fallback {
  display: inline-block;
  background: #FFF3CD;
  border: 2px dashed #FFB938;
  padding: 8px 12px;
  border-radius: 6px;
  color: #856404;
  font-weight: 600;
  font-family: monospace;
  font-size: 13px;
}
</style>
` : ''}

### i18n
Par d√©faut FR/EN/AR (Alg√©rie) + s√©lecteur de langue (drapeaux).

### Analytics (head)
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CRRK6Z4D1X"></script>
<script>
window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-CRRK6Z4D1X');
</script>

### Responsive / anti-d√©bordement
Feuille distante : https://dznet1.com/assets/css/main.css

### Accessibilit√©
Navigation clavier, focus visible, aria-label, alt descriptifs, contraste ‚â• 4.5:1.

---

## SP√âCIFICATIONS DU PROJET (JSON)
${JSON.stringify(promptData, null, 2)}

- [ ] Afficher Version ${projectVersion}
- [ ] ${testMode ? 'G√©n√©rer tableau m√©dias attendus (TXT, pas HTML)' : 'Utiliser CDN distant'}
- [ ] G√©n√©rer le **fichier HTML final complet**.`;

      document.getElementById('promptOutputModal').textContent = prompt;
      openResultModal();
      return prompt;
    }

    // ===== COPIE / EXPORT =====
    document.getElementById('copyBtnModal').addEventListener('click', function(){
      const txt = document.getElementById('promptOutputModal').textContent;
      const btn = this; btn.classList.add('loading'); btn.disabled = true;
      navigator.clipboard.writeText(txt).then(()=>{
        setTimeout(()=>{
          btn.classList.remove('loading'); btn.classList.add('copy-success');
          btn.innerHTML = '<span>‚úÖ Copi√©</span>';
          setTimeout(()=>{ btn.classList.remove('copy-success'); btn.innerHTML = '<span class="spinner"></span><span>üìã Copier</span>'; btn.disabled=false; }, 2000);
        },300);
      }).catch(()=>{
        btn.classList.remove('loading'); btn.disabled=false; alert('‚ùå Erreur de copie. S√©lectionnez manuellement le texte.');
      });
    });

    document.getElementById('downloadBtnModal').addEventListener('click', function(){
      const txt = document.getElementById('promptOutputModal').textContent;
      const blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a');
      const theme = (document.getElementById('theme').value||'').replace(/[^a-z0-9]/gi,'_').toLowerCase();
      const creator = (document.getElementById('creatorName').value||'').replace(/[^a-z0-9]/gi,'_').toLowerCase();
      const version = (document.getElementById('projectVersion').value||'').replace(/[^a-z0-9.]/gi,'');
      const ts = new Date().toISOString().slice(0,10);
      a.href = url; a.download = `prompt_${theme}_${creator}_${version}_${ts}.txt`;
      document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
