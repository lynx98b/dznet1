<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CRRK6Z4D1X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CRRK6Z4D1X');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="G√©n√©rateur intelligent de contenu √©ducatif avec adaptation automatique selon l'√¢ge - 1 √† 3 pages maximum" />
  <title>G√©n√©rateur Intelligent v3.0 - Contenu √âducatif Adaptatif</title>

  <style>
    /* ===== VARIABLES & RESET ===== */
    :root{
      --primary:#4A90E2;--success:#27AE60;--warning:#F39C12;--danger:#E74C3C;--info:#3498DB;
      --bg-light:#F8F9FA;--text-dark:#2C3E50;--border:#DFE6E9;--shadow:rgba(0,0,0,0.1);
      --age-3-4:#FFE4E1;--age-5-6:#E0F2F7;--age-7-8:#FFF9C4;--age-9-10:#D1F2EB;--age-11-12:#E1BEE7;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;padding:20px;color:var(--text-dark)
    }
    
    /* ===== INDICATEUR D'INTELLIGENCE ===== */
    .intelligence-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 1000;
      min-width: 200px;
    }
    .intelligence-indicator h4 {
      margin: 0 0 10px 0;
      color: var(--primary);
      font-size: 14px;
    }
    .intelligence-status {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    .status-dot.active {
      background: var(--success);
    }
    .status-dot.inactive {
      background: var(--border);
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }
    .age-badge {
      display: inline-block;
      padding: 4px 12px;
      background: var(--info);
      color: white;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .container{max-width:1000px;margin:0 auto;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden}
    header{background:linear-gradient(135deg,var(--primary) 0%,#357ABD 100%);color:#fff;padding:30px;text-align:center;position:relative}
    header h1{font-size:26px;margin-bottom:10px}
    header p{font-size:14px;opacity:.95}
    .version-badge{position:absolute;top:15px;right:15px;background:rgba(255,255,255,.2);padding:5px 15px;border-radius:20px;font-size:12px;font-weight:600}
    
    /* ===== ALERTE ADAPTATIVE ===== */
    .adaptive-alert {
      background: linear-gradient(135deg, #FFF9E6 0%, #FFE4B5 100%);
      border-left: 5px solid var(--warning);
      padding: 20px;
      margin: 20px;
      border-radius: 8px;
      display: none;
    }
    .adaptive-alert.active {
      display: block;
      animation: slideDown 0.4s ease;
    }
    .adaptive-alert h3 {
      color: var(--warning);
      margin: 0 0 10px 0;
      font-size: 18px;
    }
    .adaptive-alert ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    .adaptive-alert li {
      margin: 5px 0;
      font-size: 14px;
    }
    .constraint-tag {
      display: inline-block;
      background: white;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 8px;
    }
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* ===== CHAMPS D√âSACTIV√âS INTELLIGENTS ===== */
    .field-disabled-auto {
      position: relative;
      opacity: 0.5;
      pointer-events: none;
    }
    .field-disabled-auto::after {
      content: attr(data-reason);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(231, 76, 60, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .field-disabled-auto:hover::after {
      opacity: 1;
    }
    
    /* ===== CHAMPS RECOMMAND√âS ===== */
    .field-recommended {
      background: linear-gradient(135deg, #E8F4F8 0%, #D4E9F3 100%);
      border: 2px solid var(--info);
      border-radius: 8px;
      padding: 2px;
    }
    .field-forced {
      background: linear-gradient(135deg, #FFF9E6 0%, #FFE4B5 100%);
      border: 2px solid var(--warning);
    }
    
    .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.7);animation:fadeIn .3s;overflow-y:auto;padding:20px}
    .modal.active{display:flex;align-items:center;justify-content:center}
    .modal-content{background:#fff;padding:40px;border-radius:16px;max-width:700px;width:100%;max-height:85vh;overflow-y:auto;position:relative;animation:slideDown .4s}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideDown{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}
    .modal-close{position:absolute;top:15px;right:15px;background:var(--danger);color:#fff;border:none;width:35px;height:35px;border-radius:50%;cursor:pointer;font-size:20px;font-weight:700;transition:.3s}
    .modal-close:hover{background:#C0392B;transform:rotate(90deg)}
    
    .form-wrapper{padding:40px}
    .metadata-section{background:#FFF9E6;padding:20px;border-radius:12px;margin-bottom:30px;border:2px solid var(--warning)}
    .section{margin-bottom:40px;padding-bottom:30px;border-bottom:2px solid var(--border)}
    .section:last-child{border-bottom:none}
    .section-title{font-size:20px;color:var(--primary);margin-bottom:20px;display:flex;align-items:center;gap:10px}
    .form-group{margin-bottom:20px;position:relative}
    label{display:block;font-weight:600;margin-bottom:8px;font-size:15px}
    label.required::after{content:" *";color:var(--danger)}
    
    .error-message{display:none;color:var(--danger);font-size:13px;font-weight:600;margin-top:5px;padding:8px 12px;background:#FADBD8;border-radius:4px;border-left:3px solid var(--danger)}
    .form-group.has-error .error-message{display:block;animation:shake .5s}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
    
    input[type="text"],input[type="date"],select,textarea{width:100%;padding:12px;border:2px solid var(--border);border-radius:8px;font-size:14px;transition:.3s;font-family:inherit}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(74,144,226,.1)}
    textarea{min-height:80px;resize:vertical}
    
    .checkbox-group,.radio-group{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:12px}
    .checkbox-item,.radio-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--bg-light);border-radius:8px;cursor:pointer;transition:.3s;border:2px solid transparent}
    .checkbox-item:hover,.radio-item:hover{background:#E8F4F8;border-color:var(--primary)}
    .checkbox-item input:checked ~ span,.radio-item input:checked ~ span{font-weight:600;color:var(--primary)}
    input[type="checkbox"],input[type="radio"]{width:20px;height:20px;cursor:pointer;flex-shrink:0}
    
    .button-group{display:flex;gap:15px;flex-wrap:wrap;margin-top:30px}
    button{padding:15px 30px;font-size:16px;font-weight:600;border:none;border-radius:8px;cursor:pointer;transition:.3s;display:flex;align-items:center;gap:10px;justify-content:center}
    button:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:var(--primary);color:#fff;flex:1;min-width:200px}
    .btn-primary:hover:not(:disabled){background:#357ABD;transform:translateY(-2px);box-shadow:0 5px 15px rgba(74,144,226,.4)}
    .btn-success{background:var(--success);color:#fff;flex:1;min-width:200px}
    .btn-secondary{background:var(--border);color:var(--text-dark)}
    .btn-intelligence{background:linear-gradient(135deg,var(--warning) 0%,#E67E22 100%);color:#fff}
    .btn-intelligence:hover{transform:scale(1.05);box-shadow:0 5px 20px rgba(243,156,18,.5)}
    
    .spinner{display:none;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    button.loading .spinner{display:block}
    button.loading span:not(.spinner){display:none}
    
    .helper-text{font-size:13px;color:#7F8C8D;margin-top:5px;font-style:italic}
    .info-banner{background:#E3F2FD;border-left:4px solid var(--info);padding:15px;margin:20px 0;border-radius:4px;font-size:14px}
    .warning-banner{background:#FFF3CD;border-left:4px solid var(--warning);padding:15px;margin:20px 0;border-radius:4px;font-size:14px}
    
    /* ===== COMPTEURS VISUELS ===== */
    .visual-counters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .counter-card {
      background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      border: 2px solid transparent;
      transition: 0.3s;
    }
    .counter-card.active {
      border-color: var(--primary);
      background: linear-gradient(135deg, #E8F4F8 0%, #D4E9F3 100%);
    }
    .counter-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary);
    }
    .counter-label {
      font-size: 12px;
      color: var(--text-dark);
      margin-top: 5px;
    }
    
    /* ===== PREVIEW TEMPS R√âEL ===== */
    .live-preview {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      max-width: 300px;
      display: none;
    }
    .live-preview.active {
      display: block;
    }
    .preview-title {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 10px;
      font-size: 14px;
    }
    .preview-content {
      font-size: 12px;
      line-height: 1.6;
    }
    .preview-tag {
      display: inline-block;
      padding: 2px 8px;
      background: var(--bg-light);
      border-radius: 12px;
      margin: 2px;
      font-size: 11px;
    }
    
    @media (max-width:768px){
      body{padding:10px}
      .form-wrapper{padding:20px}
      header h1{font-size:20px}
      .button-group{flex-direction:column}
      .btn-primary,.btn-success{width:100%}
      .intelligence-indicator{position:static;margin:20px;width:auto}
      .live-preview{position:static;margin:20px;max-width:100%}
    }
  </style>
</head>
<body>
  <!-- INDICATEUR D'INTELLIGENCE -->
  <div class="intelligence-indicator" id="intelligenceIndicator">
    <h4>üß† Intelligence Adaptative</h4>
    <div class="intelligence-status">
      <span class="status-dot inactive" id="statusDot"></span>
      <span id="statusText">Non activ√©e</span>
    </div>
    <div id="ageDetected" style="margin-top:10px;display:none;">
      <span class="age-badge" id="ageBadge">-</span>
    </div>
  </div>

  <div class="container">
    <!-- HEADER -->
    <header>
      <span class="version-badge">v3.0 INTELLIGENT</span>
      <h1>üß† G√©n√©rateur Intelligent - Contenu √âducatif Adaptatif</h1>
      <p>‚ú® Auto-adaptation selon l'√¢ge ‚Ä¢ üìÑ 1-3 pages maximum ‚Ä¢ üéØ Templates optimis√©s</p>
    </header>

    <!-- ALERTE ADAPTATIVE -->
    <div class="adaptive-alert" id="adaptiveAlert">
      <h3>üéØ Intelligence Activ√©e</h3>
      <div id="alertContent"></div>
    </div>

    <!-- FORMULAIRE -->
    <div class="form-wrapper">
      <!-- BOUTON INTELLIGENCE -->
      <div class="button-group" style="margin-bottom:30px;">
        <button type="button" class="btn-intelligence" id="activateIntelligence">
          <span>üß†</span>
          <span>Activer l'Intelligence Auto-Adaptative</span>
        </button>
      </div>

      <form id="promptForm">
        <!-- M√âTADONN√âES -->
        <div class="metadata-section">
          <h3 style="color:var(--warning);margin-bottom:15px;">üìù Informations du Projet</h3>
          <div class="form-group">
            <label for="creatorName" class="required">Votre nom</label>
            <input type="text" id="creatorName" placeholder="Ex: Marie Dupont" required>
            <div class="error-message">Champ obligatoire</div>
          </div>
        </div>

        <!-- 1Ô∏è‚É£ PUBLIC CIBLE - D√âCLENCHEUR INTELLIGENCE -->
        <div class="section">
          <h2 class="section-title">
            1Ô∏è‚É£ Public Cible 
            <span style="background:var(--warning);color:white;padding:2px 8px;border-radius:4px;font-size:12px;">
              D√âCLENCHEUR IA
            </span>
          </h2>
          
          <div class="warning-banner">
            <strong>‚ö° S√©lectionnez l'√¢ge EN PREMIER !</strong><br>
            Le syst√®me adaptera automatiquement TOUS les autres champs selon l'√¢ge choisi.
          </div>

          <div class="form-group" id="ageGroup">
            <label class="required">Tranche d'√¢ge (d√©termine tout le reste)</label>
            <div class="radio-group">
              <label class="radio-item">
                <input type="radio" name="ageRange" value="3-4" data-label="3-4 ans (Petite section)">
                <span>üë∂ 3-4 ans (1 page max)</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="ageRange" value="5-6" data-label="5-6 ans (Grande section/CP)">
                <span>üßí 5-6 ans (2 pages max)</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="ageRange" value="7-8" data-label="7-8 ans (CE1/CE2)">
                <span>üë¶ 7-8 ans (2 pages max)</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="ageRange" value="9-10" data-label="9-10 ans (CM1/CM2)">
                <span>üëß 9-10 ans (3 pages max)</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="ageRange" value="11-12" data-label="11-12 ans (Coll√®ge)">
                <span>üßë 11-12 ans (3 pages max)</span>
              </label>
            </div>
            <div class="error-message">S√©lectionnez une tranche d'√¢ge</div>
          </div>

          <!-- COMPTEURS VISUELS -->
          <div class="visual-counters">
            <div class="counter-card" id="pagesCounter">
              <div class="counter-value">-</div>
              <div class="counter-label">Pages max</div>
            </div>
            <div class="counter-card" id="wordsCounter">
              <div class="counter-value">-</div>
              <div class="counter-label">Mots/page</div>
            </div>
            <div class="counter-card" id="complexityCounter">
              <div class="counter-value">-</div>
              <div class="counter-label">Complexit√©</div>
            </div>
            <div class="counter-card" id="visualCounter">
              <div class="counter-value">-</div>
              <div class="counter-label">% Visuel</div>
            </div>
          </div>

          <div class="form-group" id="readingGroup">
            <label class="required">Niveau de lecture (auto-adapt√©)</label>
            <div class="radio-group">
              <label class="radio-item">
                <input type="radio" name="readingLevel" value="Pr√©-lecteur">
                <span>Pr√©-lecteur (images/audio)</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="readingLevel" value="Lecteur d√©butant">
                <span>Lecteur d√©butant</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="readingLevel" value="Lecteur autonome">
                <span>Lecteur autonome</span>
              </label>
            </div>
            <div class="error-message">S√©lectionnez un niveau</div>
          </div>
        </div>

        <!-- 2Ô∏è‚É£ TYPE & TH√àME -->
        <div class="section">
          <h2 class="section-title">2Ô∏è‚É£ Contenu Principal</h2>
          
          <div class="form-group" id="contentTypeGroup">
            <label class="required">Type de contenu (filtr√© par √¢ge)</label>
            <select id="contentType" required>
              <option value="">‚Äî S√©lectionner ‚Äî</option>
              <option value="histoire">üìñ Histoire</option>
              <option value="jeu_educatif">üéÆ Jeu √©ducatif</option>
              <option value="quiz">‚ùì Quiz</option>
              <option value="coloriage">üé® Coloriage</option>
              <option value="puzzle">üß© Puzzle</option>
              <option value="memoire">üß† M√©moire</option>
              <option value="exercice">‚úèÔ∏è Exercice</option>
            </select>
            <div class="error-message">Choisissez un type</div>
          </div>

          <div class="form-group" id="themeGroup">
            <label for="theme" class="required">Sujet/Th√®me (simple et clair)</label>
            <input type="text" id="theme" placeholder="Ex: Les animaux, Les couleurs, Les plan√®tes" required maxlength="50">
            <div class="error-message">D√©crivez le sujet</div>
            <span class="helper-text">Maximum 50 caract√®res - Soyez pr√©cis</span>
          </div>
        </div>

        <!-- 3Ô∏è‚É£ OBJECTIFS SIMPLIFI√âS -->
        <div class="section">
          <h2 class="section-title">3Ô∏è‚É£ Objectifs P√©dagogiques (auto-filtr√©s)</h2>
          
          <div class="info-banner" id="objectivesInfo">
            Les objectifs sont automatiquement filtr√©s selon l'√¢ge s√©lectionn√©
          </div>

          <div class="form-group" id="goalsGroup">
            <label>Objectifs disponibles</label>
            <div class="checkbox-group" id="goalsContainer">
              <!-- G√©n√©r√© dynamiquement selon l'√¢ge -->
            </div>
            <div class="error-message">Choisissez au moins un objectif</div>
          </div>
        </div>

        <!-- 4Ô∏è‚É£ INTERACTIONS -->
        <div class="section">
          <h2 class="section-title">4Ô∏è‚É£ Interactions (adapt√©es √† l'√¢ge)</h2>
          <div class="form-group">
            <label>Types d'interactions</label>
            <div class="checkbox-group" id="interactionsContainer">
              <!-- G√©n√©r√© dynamiquement selon l'√¢ge -->
            </div>
          </div>
        </div>

        <!-- 5Ô∏è‚É£ VERSION PAPIER -->
        <div class="section">
          <h2 class="section-title">5Ô∏è‚É£ Version Papier</h2>
          <div class="form-group">
            <label class="checkbox-item">
              <input type="checkbox" id="generatePaper" name="generatePaper">
              <span>üìÑ G√©n√©rer aussi une version Word/PDF imprimable</span>
            </label>
            <span class="helper-text">Document adapt√© √† l'√¢ge avec exercices, coloriages, corrig√©s</span>
          </div>
        </div>

        <!-- BOUTONS -->
        <div class="button-group">
          <button type="submit" class="btn-primary">
            <span class="spinner"></span>
            <span>üöÄ G√©n√©rer le Prompt Intelligent</span>
          </button>
          <button type="reset" class="btn-secondary">üîÑ R√©initialiser</button>
        </div>
      </form>
    </div>
  </div>

  <!-- PREVIEW TEMPS R√âEL -->
  <div class="live-preview" id="livePreview">
    <div class="preview-title">üìä Aper√ßu Temps R√©el</div>
    <div class="preview-content" id="previewContent"></div>
  </div>

  <script>
    // ===== CONFIGURATION INTELLIGENCE v3.0 =====
    const VERSION = "v3.0";
    const STORAGE_KEY = 'intelligent_generator_v3';
    
    // ===== D√âFINITIONS INTELLIGENTES PAR √ÇGE =====
    const AGE_PROFILES = {
      '3-4': {
        label: '3-4 ans (Petite section)',
        readingLevel: 'Pr√©-lecteur',
        maxPages: 1,
        maxWordsPerPage: 300,
        complexity: 1,
        visualRatio: 70,
        fontSize: '24px',
        supervision: 'Adulte pr√©sent obligatoire',
        
        allowedTypes: ['coloriage', 'histoire', 'memoire'],
        disallowedTypes: ['quiz', 'exercice', 'puzzle'],
        
        objectives: [
          'Reconnaissance des couleurs primaires',
          'Identification formes simples (rond, carr√©, triangle)',
          'Comptage 1-5',
          'Reconnaissance animaux familiers',
          'Coordination main-≈ìil'
        ],
        
        interactions: [
          'Clic sur image = son',
          'Colorier grandes zones',
          'Glisser 2-3 objets maximum'
        ],
        
        template: `
=== CONTENU 3-4 ANS (1 PAGE MAX) ===
- TITRE COURT : {THEME} (max 3 mots)
- STRUCTURE : 70% images, 30% texte
- INSTRUCTIONS : 3-5 mots max par phrase
- ACTIVIT√âS : 3-4 maximum, tr√®s simples
- SONS : Obligatoires pour chaque action
- MASCOTTE : Grande et souriante
- PAS DE TEXTE SEUL - toujours avec images`,
        
        paperTemplate: `
PAGE UNIQUE A4 - FORMAT 3-4 ANS
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    GRANDE IMAGE CENTRALE    ‚îÇ
‚îÇ      √Ä COLORIER (15x15cm)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Instruction: {INSTRUCTION_3_MOTS}

[Zone Parent]: Encouragez apr√®s chaque r√©ussite`
      },
      
      '5-6': {
        label: '5-6 ans (Grande section/CP)',
        readingLevel: 'Lecteur d√©butant',
        maxPages: 2,
        maxWordsPerPage: 250,
        complexity: 2,
        visualRatio: 50,
        fontSize: '20px',
        supervision: 'Semi-autonome',
        
        allowedTypes: ['histoire', 'jeu_educatif', 'coloriage', 'puzzle', 'memoire'],
        disallowedTypes: ['exercice'],
        
        objectives: [
          'Reconnaissance alphabet majuscules',
          'Comptage 1-20',
          'Couleurs primaires et secondaires',
          'Formes g√©om√©triques de base',
          'Syllabes simples',
          'S√©quences logiques simples',
          'Reconnaissance sons/lettres'
        ],
        
        interactions: [
          'Quiz 3 choix avec images',
          'Puzzle 6-9 pi√®ces',
          'Memory 4-6 paires',
          'Glisser-d√©poser simple',
          'Coloriage guid√©'
        ],
        
        template: `
=== CONTENU 5-6 ANS (2 PAGES MAX) ===
PAGE 1 : D√âCOUVERTE
- Titre attractif
- Personnage guide
- 3 √©l√©ments √† d√©couvrir
- Phrases 6-8 mots

PAGE 2 : ACTIVIT√â  
- Quiz 3-4 questions
- R√©compense visuelle
- Sons encourageants`,
        
        paperTemplate: `
DOCUMENT 2 PAGES - CP
Page 1: Histoire + images
Page 2: 3 exercices simples
Corrig√© pour parents inclus`
      },
      
      '7-8': {
        label: '7-8 ans (CE1/CE2)',
        readingLevel: 'Lecteur autonome',
        maxPages: 2,
        maxWordsPerPage: 400,
        complexity: 3,
        visualRatio: 40,
        fontSize: '18px',
        supervision: 'Semi-autonome',
        
        allowedTypes: ['tous'],
        disallowedTypes: [],
        
        objectives: [
          'Lecture phrases compl√®tes',
          'Addition/soustraction simples',
          'Compr√©hension de texte',
          'Vocabulaire √©largi',
          'Notions temps/espace',
          'Sciences basiques',
          'R√©solution probl√®mes simples'
        ],
        
        interactions: [
          'Quiz 5-6 questions',
          'Histoire √† choix multiples',
          'Labyrinthe simple',
          'Tri par cat√©gories',
          'Puzzle 12-16 pi√®ces'
        ],
        
        template: `
=== CONTENU 7-8 ANS (2 PAGES) ===
- Texte structur√©
- Mini-jeux int√©gr√©s
- D√©fis progressifs
- Auto-√©valuation`,
        
        paperTemplate: `
CE1/CE2 - Document structur√©
Exercices vari√©s + solutions`
      },
      
      '9-10': {
        label: '9-10 ans (CM1/CM2)',
        readingLevel: 'Lecteur autonome',
        maxPages: 3,
        maxWordsPerPage: 400,
        complexity: 4,
        visualRatio: 30,
        fontSize: '16px',
        supervision: 'Totalement autonome',
        
        allowedTypes: ['tous'],
        disallowedTypes: [],
        
        objectives: [
          'Tous les objectifs disponibles',
          'Multiplication/division',
          'Fractions simples',
          'Sciences avanc√©es',
          'Histoire/g√©ographie',
          'Raisonnement logique'
        ],
        
        interactions: [
          'QCM 8-10 questions',
          'Exercices de r√©flexion',
          'Mini-projets',
          'Cr√©ation de contenu'
        ],
        
        template: `
=== CONTENU 9-10 ANS (3 PAGES) ===
Structure compl√®te avec sommaire
√âvaluation finale
Ressources suppl√©mentaires`,
        
        paperTemplate: `
CM1/CM2 - Document complet
Th√©orie + Pratique + Projet`
      },
      
      '11-12': {
        label: '11-12 ans (Coll√®ge)',
        readingLevel: 'Lecteur autonome',
        maxPages: 3,
        maxWordsPerPage: 500,
        complexity: 5,
        visualRatio: 20,
        fontSize: '14px',
        supervision: 'Totalement autonome',
        
        allowedTypes: ['tous'],
        disallowedTypes: [],
        
        objectives: ['Tous les objectifs'],
        interactions: ['Toutes les interactions'],
        
        template: `
=== CONTENU COLL√àGE (3 PAGES MAX) ===
Format libre, gamification avanc√©e`,
        
        paperTemplate: `
COLL√àGE - Format acad√©mique`
      }
    };
    
    // ===== VARIABLES GLOBALES =====
    let currentAgeProfile = null;
    let intelligenceActive = false;
    
    // ===== FONCTION INTELLIGENCE PRINCIPALE =====
    function activateIntelligence() {
      const selectedAge = document.querySelector('input[name="ageRange"]:checked');
      
      if (!selectedAge) {
        alert('‚ö†Ô∏è S√©lectionnez d\'abord une tranche d\'√¢ge !');
        document.getElementById('ageGroup').scrollIntoView({behavior: 'smooth'});
        return;
      }
      
      const ageKey = selectedAge.value;
      currentAgeProfile = AGE_PROFILES[ageKey];
      
      if (!currentAgeProfile) return;
      
      intelligenceActive = true;
      
      // Mise √† jour indicateur
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      const ageDetected = document.getElementById('ageDetected');
      const ageBadge = document.getElementById('ageBadge');
      
      statusDot.className = 'status-dot active';
      statusText.textContent = 'Intelligence activ√©e';
      ageDetected.style.display = 'block';
      ageBadge.textContent = currentAgeProfile.label;
      
      // Mise √† jour compteurs visuels
      document.getElementById('pagesCounter').classList.add('active');
      document.querySelector('#pagesCounter .counter-value').textContent = currentAgeProfile.maxPages;
      
      document.getElementById('wordsCounter').classList.add('active');
      document.querySelector('#wordsCounter .counter-value').textContent = currentAgeProfile.maxWordsPerPage;
      
      document.getElementById('complexityCounter').classList.add('active');
      document.querySelector('#complexityCounter .counter-value').textContent = currentAgeProfile.complexity + '/5';
      
      document.getElementById('visualCounter').classList.add('active');
      document.querySelector('#visualCounter .counter-value').textContent = currentAgeProfile.visualRatio + '%';
      
      // Auto-s√©lectionner niveau lecture
      const readingRadio = document.querySelector(`input[name="readingLevel"][value="${currentAgeProfile.readingLevel}"]`);
      if (readingRadio) {
        readingRadio.checked = true;
        readingRadio.closest('.radio-item').classList.add('field-forced');
      }
      
      // Filtrer types de contenu
      const contentSelect = document.getElementById('contentType');
      Array.from(contentSelect.options).forEach(option => {
        if (option.value && currentAgeProfile.disallowedTypes.includes(option.value)) {
          option.disabled = true;
          option.style.color = '#999';
          option.text = option.text + ' (Non adapt√©)';
        } else {
          option.disabled = false;
          option.style.color = '';
        }
      });
      
      // G√©n√©rer objectifs filtr√©s
      const goalsContainer = document.getElementById('goalsContainer');
      goalsContainer.innerHTML = '';
      currentAgeProfile.objectives.forEach(obj => {
        const label = document.createElement('label');
        label.className = 'checkbox-item';
        label.innerHTML = `
          <input type="checkbox" name="goals" value="${obj}">
          <span>${obj}</span>
        `;
        goalsContainer.appendChild(label);
      });
      
      // G√©n√©rer interactions adapt√©es
      const interactionsContainer = document.getElementById('interactionsContainer');
      interactionsContainer.innerHTML = '';
      currentAgeProfile.interactions.forEach(inter => {
        const label = document.createElement('label');
        label.className = 'checkbox-item';
        label.innerHTML = `
          <input type="checkbox" name="interactions" value="${inter}">
          <span>${inter}</span>
        `;
        interactionsContainer.appendChild(label);
      });
      
      // Afficher alerte adaptative
      const alert = document.getElementById('adaptiveAlert');
      const alertContent = document.getElementById('alertContent');
      
      alertContent.innerHTML = `
        <ul>
          <li><strong>Pages maximum :</strong> 
            <span class="constraint-tag">${currentAgeProfile.maxPages} page(s)</span>
          </li>
          <li><strong>Mots par page :</strong> 
            <span class="constraint-tag">${currentAgeProfile.maxWordsPerPage} mots max</span>
          </li>
          <li><strong>Ratio visuel :</strong> 
            <span class="constraint-tag">${currentAgeProfile.visualRatio}% images</span>
          </li>
          <li><strong>Complexit√© :</strong> 
            <span class="constraint-tag">Niveau ${currentAgeProfile.complexity}/5</span>
          </li>
          <li><strong>Police recommand√©e :</strong> 
            <span class="constraint-tag">${currentAgeProfile.fontSize}</span>
          </li>
        </ul>
      `;
      
      alert.classList.add('active');
      
      // Activer preview
      updateLivePreview();
      
      // Scroll vers le formulaire
      setTimeout(() => {
        document.getElementById('contentTypeGroup').scrollIntoView({behavior: 'smooth', block: 'center'});
      }, 500);
    }
    
    // ===== MISE √Ä JOUR PREVIEW =====
    function updateLivePreview() {
      if (!intelligenceActive || !currentAgeProfile) return;
      
      const preview = document.getElementById('livePreview');
      const content = document.getElementById('previewContent');
      
      const theme = document.getElementById('theme').value || 'Non d√©fini';
      const type = document.getElementById('contentType').value || 'Non d√©fini';
      
      content.innerHTML = `
        <p><strong>√Çge :</strong> ${currentAgeProfile.label}</p>
        <p><strong>Th√®me :</strong> ${theme}</p>
        <p><strong>Type :</strong> ${type}</p>
        <div style="margin-top:10px;">
          <span class="preview-tag">${currentAgeProfile.maxPages} page(s)</span>
          <span class="preview-tag">${currentAgeProfile.maxWordsPerPage} mots</span>
          <span class="preview-tag">${currentAgeProfile.visualRatio}% visuel</span>
        </div>
      `;
      
      preview.classList.add('active');
    }
    
    // ===== G√âN√âRATION PROMPT INTELLIGENT =====
    function generateIntelligentPrompt() {
      if (!currentAgeProfile) {
        alert('‚ö†Ô∏è Activez d\'abord l\'intelligence adaptative !');
        return null;
      }
      
      const creatorName = document.getElementById('creatorName').value;
      const theme = document.getElementById('theme').value;
      const contentType = document.getElementById('contentType').value;
      const generatePaper = document.getElementById('generatePaper').checked;
      
      const selectedGoals = Array.from(document.querySelectorAll('input[name="goals"]:checked'))
        .map(cb => cb.value);
      const selectedInteractions = Array.from(document.querySelectorAll('input[name="interactions"]:checked'))
        .map(cb => cb.value);
      
      let prompt = `# üß† PROMPT INTELLIGENT - ${theme.toUpperCase()}
## Version: ${VERSION} | √Çge: ${currentAgeProfile.label}
## ‚ö†Ô∏è CONTRAINTES STRICTES D'√ÇGE

### LIMITES ABSOLUES
- **PAGES:** ${currentAgeProfile.maxPages} MAXIMUM
- **MOTS/PAGE:** ${currentAgeProfile.maxWordsPerPage} MAXIMUM  
- **VISUEL:** ${currentAgeProfile.visualRatio}% images, ${100 - currentAgeProfile.visualRatio}% texte
- **POLICE:** ${currentAgeProfile.fontSize} minimum
- **COMPLEXIT√â:** Niveau ${currentAgeProfile.complexity}/5

${currentAgeProfile.template}

## PROJET
- Cr√©ateur: ${creatorName}
- Th√®me: ${theme}
- Type: ${contentType}
- Date: ${new Date().toLocaleDateString('fr-FR')}

## OBJECTIFS (${selectedGoals.length})
${selectedGoals.map((g, i) => `${i+1}. ${g}`).join('\n')}

## INTERACTIONS
${selectedInteractions.map(i => `‚Ä¢ ${i}`).join('\n')}
`;

      if (generatePaper) {
        prompt += `

## üìÑ VERSION PAPIER OBLIGATOIRE
${currentAgeProfile.paperTemplate}

G√âN√âRER:
1. HTML complet (${currentAgeProfile.maxPages} page max)
2. Code Python pour Word/PDF adapt√© ${currentAgeProfile.label}
`;
      }

      prompt += `

## üö® G√âN√âRATION IMM√âDIATE
Produis MAINTENANT le code HTML complet en respectant STRICTEMENT les ${currentAgeProfile.maxPages} page(s) maximum et ${currentAgeProfile.maxWordsPerPage} mots par page.
`;

      return prompt;
    }
    
    // ===== VALIDATION =====
    function validateForm() {
      let valid = true;
      
      // V√©rifier nom
      if (!document.getElementById('creatorName').value.trim()) {
        document.getElementById('creatorName').closest('.form-group').classList.add('has-error');
        valid = false;
      }
      
      // V√©rifier √¢ge
      if (!document.querySelector('input[name="ageRange"]:checked')) {
        document.getElementById('ageGroup').classList.add('has-error');
        valid = false;
      }
      
      // V√©rifier th√®me
      if (!document.getElementById('theme').value.trim()) {
        document.getElementById('themeGroup').classList.add('has-error');
        valid = false;
      }
      
      return valid;
    }
    
    // ===== EVENT LISTENERS =====
    document.addEventListener('DOMContentLoaded', function() {
      // Bouton intelligence
      document.getElementById('activateIntelligence').addEventListener('click', activateIntelligence);
      
      // Changement d'√¢ge
      document.querySelectorAll('input[name="ageRange"]').forEach(radio => {
        radio.addEventListener('change', function() {
          if (intelligenceActive) {
            activateIntelligence();
          }
        });
      });
      
      // Mise √† jour preview
      document.getElementById('theme').addEventListener('input', updateLivePreview);
      document.getElementById('contentType').addEventListener('change', updateLivePreview);
      
      // Submit form
      document.getElementById('promptForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!validateForm()) {
          alert('‚ö†Ô∏è Veuillez remplir tous les champs obligatoires');
          return;
        }
        
        if (!intelligenceActive) {
          alert('‚ö†Ô∏è Activez d\'abord l\'intelligence adaptative !');
          return;
        }
        
        const prompt = generateIntelligentPrompt();
        
        if (prompt) {
          // Cr√©er et t√©l√©charger le fichier
          const blob = new Blob([prompt], {type: 'text/plain'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `prompt_intelligent_${currentAgeProfile.label.replace(/\s/g, '_')}_${Date.now()}.txt`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          
          alert('‚úÖ Prompt intelligent g√©n√©r√© et t√©l√©charg√© !');
        }
      });
      
      // Reset form
      document.getElementById('promptForm').addEventListener('reset', function() {
        setTimeout(() => {
          intelligenceActive = false;
          currentAgeProfile = null;
          document.getElementById('statusDot').className = 'status-dot inactive';
          document.getElementById('statusText').textContent = 'Non activ√©e';
          document.getElementById('ageDetected').style.display = 'none';
          document.getElementById('adaptiveAlert').classList.remove('active');
          document.getElementById('livePreview').classList.remove('active');
          document.querySelectorAll('.counter-card').forEach(card => {
            card.classList.remove('active');
            card.querySelector('.counter-value').textContent = '-';
          });
          document.querySelectorAll('.has-error').forEach(el => {
            el.classList.remove('has-error');
          });
        }, 100);
      });
      
      // Charger nom sauvegard√©
      const savedName = localStorage.getItem(STORAGE_KEY);
      if (savedName) {
        document.getElementById('creatorName').value = savedName;
      }
      
      // Sauvegarder nom
      document.getElementById('creatorName').addEventListener('blur', function() {
        const name = this.value.trim();
        if (name) {
          localStorage.setItem(STORAGE_KEY, name);
        }
      });
    });
    
    console.log('‚úÖ Intelligence Adaptative v3.0 charg√©e');
  </script>
</body>
</html>
