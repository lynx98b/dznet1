<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DzNet1 - أداة التصنيف</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .url-helper {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .url-preview {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }
        .url-examples {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .granularity-option {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        .granularity-option:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        .granularity-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Toggle Language -->
    <div class="lang-toggle" onclick="toggleLanguage()">
        <span id="langText">🇩🇿 Français</span>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                <span class="logo-icon"></span>
                <span class="logo-text">
                    <span class="dz">Dz</span><span class="net">Net1</span><span class="com">.com</span>
                </span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link" data-ar="الرئيسية" data-fr="Accueil">الرئيسية</a></li>
                <li><a href="filtres.html" class="nav-link" data-ar="الفلاتر المجتمعية" data-fr="Filtres Communautaires">الفلاتر المجتمعية</a></li>
                <li><a href="enfants.html" class="nav-link" data-ar="بوابة الأطفال" data-fr="Portail Enfants">بوابة الأطفال</a></li>
                <li><a href="faq.html" class="nav-link" data-ar="الأسئلة الشائعة" data-fr="FAQ">الأسئلة الشائعة</a></li>
                <li><a href="categorisation.html" class="nav-link active" data-ar="التصنيف" data-fr="Catégorisation">التصنيف</a></li>
                <li><a href="contact.html" class="nav-link" data-ar="اتصل بنا" data-fr="Contact">اتصل بنا</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero">
        <h1>
            <span class="hero-icon" style="font-size: 48px;">🔍</span>
            <span data-ar="أداة التصنيف" data-fr="Outil de Catégorisation">أداة التصنيف</span>
        </h1>
        <p data-ar="ساعد المجتمع في تصنيف المواقع في الفئات الصحيحة" data-fr="Aidez la communauté à classer les sites web dans les bonnes catégories">ساعد المجتمع في تصنيف المواقع في الفئات الصحيحة</p>
    </div>

    <div class="container">
        <!-- Statistics Dashboard -->
        <div class="stats-dashboard" style="margin-bottom: 60px;">
            <h3 style="text-align: center; font-size: 28px; margin-bottom: 30px;" data-ar="📊 إحصائيات المجتمع" data-fr="📊 Statistiques de la communauté">📊 إحصائيات المجتمع</h3>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-icon">🌐</div>
                    <div class="stat-number">247,832</div>
                    <div class="stat-label" data-ar="مواقع مصنفة" data-fr="Sites catégorisés">مواقع مصنفة</div>
                </div>
                
                <div class="stat-box">
                    <div class="stat-icon">👥</div>
                    <div class="stat-number">1,456</div>
                    <div class="stat-label" data-ar="متطوعين نشطين" data-fr="Contributeurs actifs">متطوعين نشطين</div>
                </div>
                
                <div class="stat-box">
                    <div class="stat-icon">📅</div>
                    <div class="stat-number">89</div>
                    <div class="stat-label" data-ar="مواقع اليوم" data-fr="Sites aujourd'hui">مواقع اليوم</div>
                </div>
                
                <div class="stat-box">
                    <div class="stat-icon">⏳</div>
                    <div class="stat-number">23</div>
                    <div class="stat-label" data-ar="في انتظار التحقق" data-fr="En attente validation">في انتظار التحقق</div>
                </div>
            </div>
        </div>

        <!-- Categorization Tool -->
        <div class="categorization-tool" style="margin-bottom: 40px;">
            <h2 style="text-align: center; color: #667eea; font-size: 32px; margin-bottom: 30px;" data-ar="🔍 تصنيف موقع جديد" data-fr="🔍 Catégoriser un nouveau site">🔍 تصنيف موقع جديد</h2>
            
            <form id="siteForm" style="max-width: 800px; margin: 0 auto;">
                
                <!-- ✨ NOUVEAU : Aide URL -->
                <div class="url-helper">
                    <h3 style="color: #1976d2; margin-bottom: 10px;">
                        💡 <span data-ar="كيف تدخل الرابط الصحيح؟" data-fr="Comment entrer l'URL correctement ?">كيف تدخل الرابط الصحيح؟</span>
                    </h3>
                    <div class="url-examples">
                        <strong>✅ <span data-ar="أمثلة صحيحة:" data-fr="Exemples corrects :">أمثلة صحيحة:</span></strong><br>
                        • <code>facebook.com</code> - <span data-ar="الموقع كامل" data-fr="Site complet">الموقع كامل</span><br>
                        • <code>ads.facebook.com</code> - <span data-ar="نطاق فرعي محدد" data-fr="Sous-domaine spécifique">نطاق فرعي محدد</span><br>
                        • <code>https://example.com/page</code> - <span data-ar="رابط كامل (سنستخرج الدومين)" data-fr="URL complète (on extrait le domaine)">رابط كامل (سنستخرج الدومين)</span><br>
                        • <code>www.site.com</code> - <span data-ar="مع www (سنحذفها تلقائياً)" data-fr="Avec www (on l'enlève auto)">مع www (سنحذفها تلقائياً)</span><br><br>
                        
                        <strong>⚠️ <span data-ar="تنبيه مهم:" data-fr="Attention importante :">تنبيه مهم:</span></strong><br>
                        <span data-ar="• حذار من حظر مواقع كاملة بسبب صفحة واحدة سيئة!" data-fr="• Attention à ne pas bloquer des sites entiers pour une seule page !">• حذار من حظر مواقع كاملة بسبب صفحة واحدة سيئة!</span><br>
                        <span data-ar="• استخدم النطاق الفرعي إذا كانت المشكلة محددة" data-fr="• Utilisez le sous-domaine si le problème est localisé">• استخدم النطاق الفرعي إذا كانت المشكلة محددة</span>
                    </div>
                </div>

                <div class="form-group">
                    <label data-ar="رابط الموقع" data-fr="URL du site">🌐 رابط الموقع أو اسم النطاق</label>
                    <input type="text" id="domainInput" placeholder="https://exemple.com" required>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        <span data-ar="يمكنك إدخال رابط كامل، وسنستخرج اسم النطاق تلقائياً" data-fr="Vous pouvez entrer une URL complète, on extrait le domaine">يمكنك إدخال رابط كامل، وسنستخرج اسم النطاق تلقائياً</span>
                    </small>
                </div>

                <!-- ✨ NOUVEAU : Prévisualisation URL -->
                <div id="urlPreview" style="display: none;" class="url-preview">
                    <h4 style="color: #2e7d32; margin-bottom: 10px;">
                        ✓ <span data-ar="تم اكتشاف المعلومات التالية:" data-fr="Informations détectées :">تم اكتشاف المعلومات التالية:</span>
                    </h4>
                    <div style="background: #f5f5f5; padding: 12px; border-radius: 6px; margin: 10px 0;">
                        <div style="margin: 5px 0;">
                            <strong><span data-ar="النطاق الرئيسي:" data-fr="Domaine principal :">النطاق الرئيسي:</span></strong> 
                            <span id="mainDomain" style="color: #1976d2; font-family: monospace;"></span>
                        </div>
                        <div style="margin: 5px 0;">
                            <strong><span data-ar="النطاق الفرعي:" data-fr="Sous-domaine :">النطاق الفرعي:</span></strong> 
                            <span id="subdomain" style="color: #f57c00; font-family: monospace;"></span>
                        </div>
                        <div style="margin: 5px 0;">
                            <strong><span data-ar="المسار:" data-fr="Chemin :">المسار:</span></strong> 
                            <span id="urlPath" style="color: #7b1fa2; font-family: monospace;"></span>
                        </div>
                    </div>

                    <!-- ✨ NOUVEAU : Choix du niveau -->
                    <h4 style="color: #d32f2f; margin: 15px 0 10px 0;">
                        ⚠️ <span data-ar="ما الذي تريد تصنيفه بالضبط؟" data-fr="Que voulez-vous catégoriser exactement ?">ما الذي تريد تصنيفه بالضبط؟</span>
                    </h4>
                    
                    <div id="granularityOptions"></div>

                    <div class="warning-box" id="warningBox" style="display: none;">
                        <strong>⚠️ <span data-ar="تحذير:" data-fr="Avertissement :">تحذير:</span></strong>
                        <span id="warningText"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label data-ar="الفئة المقترحة" data-fr="Catégorie suggérée">الفئة المقترحة</label>
                    <select id="categorySelect" required>
                        <option value="" data-ar="اختر الفئة" data-fr="Choisir la catégorie">اختر الفئة</option>
                        <option value="education" data-ar="تعليمي" data-fr="Éducatif">تعليمي</option>
                        <option value="kids" data-ar="أطفال" data-fr="Enfants">أطفال</option>
                        <option value="news" data-ar="أخبار" data-fr="Actualités">أخبار</option>
                        <option value="social" data-ar="شبكات اجتماعية" data-fr="Réseaux sociaux">شبكات اجتماعية</option>
                        <option value="gaming" data-ar="ألعاب" data-fr="Jeux">ألعاب</option>
                        <option value="adult" data-ar="محتوى بالغين" data-fr="Contenu adulte">محتوى بالغين</option>
                        <option value="violence" data-ar="عنف" data-fr="Violence">عنف</option>
                        <option value="gambling" data-ar="قمار" data-fr="Jeux d'argent">قمار</option>
                        <option value="drugs" data-ar="مخدرات/كحول" data-fr="Drogues/Alcool">مخدرات/كحول</option>
                        <option value="shopping" data-ar="تسوق" data-fr="Shopping">تسوق</option>
                        <option value="streaming" data-ar="بث مباشر" data-fr="Streaming">بث مباشر</option>
                        <option value="government" data-ar="حكومي" data-fr="Gouvernemental">حكومي</option>
                        <option value="banking" data-ar="بنوك" data-fr="Banques">بنوك</option>
                        <option value="religion" data-ar="ديني" data-fr="Religieux">ديني</option>
                        <option value="health" data-ar="صحة" data-fr="Santé">صحة</option>
                    </select>
                </div>

                <!-- Category Description -->
                <div id="categoryDescription" style="display: none; background: #f0f4ff; padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid #667eea;">
                    <h4 style="color: #667eea; margin-bottom: 10px;" data-ar="وصف الفئة:" data-fr="Description de la catégorie :">وصف الفئة:</h4>
                    <p id="descriptionText" style="color: #444; line-height: 1.6;"></p>
                </div>

                <div class="form-group">
                    <label data-ar="سبب التصنيف" data-fr="Raison de la catégorisation">سبب التصنيف</label>
                    <textarea id="reasonInput" style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; min-height: 100px; font-family: inherit;" placeholder="لماذا تعتقد أن هذا الموقع ينتمي لهذه الفئة؟" required></textarea>
                </div>

                <div class="form-group">
                    <label data-ar="اسمك المستعار (اختياري)" data-fr="Votre pseudonyme (optionnel)">اسمك المستعار (اختياري)</label>
                    <input type="text" id="contributorInput" placeholder="للظهور في قائمة المتطوعين">
                </div>

                <button type="submit" class="submit-btn">
                    <span data-ar="🔍 إرسال للمراجعة" data-fr="🔍 Envoyer pour révision">🔍 إرسال للمراجعة</span>
                </button>
            </form>
        </div>

        <!-- Result Container -->
        <div id="resultCard" style="display: none; margin-top: 30px; background: #f9f9f9; border-radius: 15px; padding: 25px; box-shadow: 0 0 10px rgba(0,0,0,0.1);"></div>

        <!-- Sites in Review -->
        <div style="background: white; border-radius: 20px; padding: 40px; margin: 40px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
            <h2 style="text-align: center; color: #667eea; font-size: 28px; margin-bottom: 30px;" data-ar="📋 آخر المواقع المضافة" data-fr="📋 Derniers sites ajoutés">📋 آخر المواقع المضافة</h2>
            
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="الموقع" data-fr="Site">الموقع</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="الفئة" data-fr="Catégorie">الفئة</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="الحالة" data-fr="Statut">الحالة</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="التحقق" data-fr="Validation">التحقق</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="التاريخ" data-fr="Date">التاريخ</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="المتطوع" data-fr="Bénévole">المتطوع</th>
                        </tr>
                    </thead>
                    <tbody id="recentSitesTable">
                        <tr>
                            <td colspan="6" style="padding: 20px; text-align: center; color: #666;">
                                <div style="font-size: 18px;">⏳ <span data-ar="جاري التحميل..." data-fr="Chargement...">جاري التحميل...</span></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Top Contributors -->
        <div style="background: white; border-radius: 20px; padding: 40px; margin: 40px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
            <h2 style="text-align: center; color: #667eea; font-size: 28px; margin-bottom: 30px;" data-ar="🏆 أفضل المتطوعين" data-fr="🏆 Top des bénévoles">🏆 أفضل المتطوعين</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px;">
                <div style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); padding: 25px; border-radius: 12px; text-align: center; color: #333;">
                    <div style="font-size: 48px; margin-bottom: 15px;">🥇</div>
                    <h3 style="margin-bottom: 10px; color: #333;">TechGuard_DZ</h3>
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px;">2,847</div>
                    <div style="font-size: 14px;" data-ar="مواقع مصنفة" data-fr="sites catégorisés">مواقع مصنفة</div>
                    <div style="margin-top: 10px; background: rgba(255,255,255,0.3); padding: 8px; border-radius: 8px;">
                        <span style="font-weight: 700;" data-ar="دقة: 96.3%" data-fr="Précision : 96.3%">دقة: 96.3%</span>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #c0c0c0 0%, #dcdcdc 100%); padding: 25px; border-radius: 12px; text-align: center; color: #333;">
                    <div style="font-size: 48px; margin-bottom: 15px;">🥈</div>
                    <h3 style="margin-bottom: 10px; color: #333;">SafeNet_Algeria</h3>
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px;">2,156</div>
                    <div style="font-size: 14px;" data-ar="مواقع مصنفة" data-fr="sites catégorisés">مواقع مصنفة</div>
                    <div style="margin-top: 10px; background: rgba(255,255,255,0.3); padding: 8px; border-radius: 8px;">
                        <span style="font-weight: 700;" data-ar="دقة: 94.8%" data-fr="Précision : 94.8%">دقة: 94.8%</span>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #cd7f32 0%, #daa520 100%); padding: 25px; border-radius: 12px; text-align: center; color: white;">
                    <div style="font-size: 48px; margin-bottom: 15px;">🥉</div>
                    <h3 style="margin-bottom: 10px; color: white;">FamilyProtector</h3>
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px;">1,923</div>
                    <div style="font-size: 14px;" data-ar="مواقع مصنفة" data-fr="sites catégorisés">مواقع مصنفة</div>
                    <div style="margin-top: 10px; background: rgba(255,255,255,0.2); padding: 8px; border-radius: 8px;">
                        <span style="font-weight: 700;" data-ar="دقة: 93.1%" data-fr="Précision : 93.1%">دقة: 93.1%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- How it works -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 50px 40px; border-radius: 20px; text-align: center; margin: 60px 0;">
            <h2 style="color: white; font-size: 32px; margin-bottom: 25px;" data-ar="🔄 كيف يعمل النظام؟" data-fr="🔄 Comment fonctionne le système ?">🔄 كيف يعمل النظام؟</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin: 40px 0;">
                <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 12px; backdrop-filter: blur(10px);">
                    <div style="font-size: 48px; margin-bottom: 15px;">📝</div>
                    <h4 style="color: white; margin-bottom: 10px;" data-ar="إرسال الطلب" data-fr="Soumettre la demande">إرسال الطلب</h4>
                    <p style="opacity: 0.9; font-size: 14px;" data-ar="أرسل رابط الموقع مع الفئة المقترحة" data-fr="Envoyez l'URL avec la catégorie suggérée">أرسل رابط الموقع مع الفئة المقترحة</p>
                </div>
                
                <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 12px; backdrop-filter: blur(10px);">
                    <div style="font-size: 48px; margin-bottom: 15px;">👥</div>
                    <h4 style="color: white; margin-bottom: 10px;" data-ar="مراجعة المجتمع" data-fr="Révision communautaire">مراجعة المجتمع</h4>
                    <p style="opacity: 0.9; font-size: 14px;" data-ar="متطوعون خبراء يراجعون ويصوتون" data-fr="Bénévoles experts examinent et votent">متطوعون خبراء يراجعون ويصوتون</p>
                </div>
                
                <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 12px; backdrop-filter: blur(10px);">
                    <div style="font-size: 48px; margin-bottom: 15px;">✅</div>
                    <h4 style="color: white; margin-bottom: 10px;" data-ar="التطبيق الفوري" data-fr="Application immédiate">التطبيق الفوري</h4>
                    <p style="opacity: 0.9; font-size: 14px;" data-ar="يطبق التصنيف على جميع أجهزة DzNet1" data-fr="Classification appliquée sur tous les appareils DzNet1">يطبق التصنيف على جميع أجهزة DzNet1</p>
                </div>
            </div>
        </div>
    </div>

        <!-- Sites in Review -->
        <div style="background: white; border-radius: 20px; padding: 40px; margin: 40px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
            <h2 style="text-align: center; color: #667eea; font-size: 28px; margin-bottom: 30px;" data-ar="📋 المواقع قيد المراجعة" data-fr="📋 Sites en cours de révision">📋 المواقع قيد المراجعة</h2>
            
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="الموقع" data-fr="Site">الموقع</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="الفئة الحالية" data-fr="Catégorie actuelle">الفئة الحالية</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="الحالة" data-fr="Statut">الحالة</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="التاريخ" data-fr="Date">التاريخ</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #dee2e6;" data-ar="المتطوع" data-fr="Bénévole">المتطوع</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">youtube.com/kids</td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                <span style="background: #d1ecf1; color: #0c5460; padding: 4px 8px; border-radius: 4px; font-size: 12px;" data-ar="أطفال" data-fr="Enfants">أطفال</span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                <span style="background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 4px; font-size: 12px;" data-ar="قيد المراجعة" data-fr="En révision">قيد المراجعة</span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center; font-size: 14px;">2025-01-15 14:23</td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">Ahmed_DZ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // ==================== CHARGEMENT DES DONNÉES AU DÉMARRAGE ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            loadStatistics();
            loadRecentSites();
        });

        // Charger les statistiques
        async function loadStatistics() {
            try {
                const response = await fetch('https://api.dznet1.com/_/api/stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalSites').textContent = data.total.toLocaleString('fr-FR');
                    document.getElementById('safeSites').textContent = data.by_status.safe.toLocaleString('fr-FR');
                    document.getElementById('warningSites').textContent = data.by_status.warning.toLocaleString('fr-FR');
                    document.getElementById('dangerSites').textContent = data.by_status.danger.toLocaleString('fr-FR');
                    document.getElementById('pendingSites').textContent = data.pending_validation.toLocaleString('fr-FR');
                }
            } catch (error) {
                console.error('Erreur chargement stats:', error);
            }
        }

        // Charger les derniers sites
        async function loadRecentSites() {
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            const t = translations[currentLang];
            
            try {
                const response = await fetch('https://api.dznet1.com/_/api/recent_sites');
                const data = await response.json();
                
                const tbody = document.getElementById('recentSitesTable');
                
                if (!data.success || data.sites.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="padding: 20px; text-align: center; color: #999;">
                                ${currentLang === 'ar' ? 'لا توجد مواقع بعد' : 'Aucun site pour le moment'}
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                data.sites.forEach(site => {
                    const categoryName = t.categories[site.category] || site.category;
                    const statusName = t.statuses[site.status] || site.status;
                    const validationName = t.statuses[site.validation_status] || site.validation_status;
                    
                    // Couleurs selon le statut
                    const statusColor = {
                        'safe': { bg: '#d4edda', color: '#155724' },
                        'warning': { bg: '#fff3cd', color: '#856404' },
                        'danger': { bg: '#f8d7da', color: '#721c24' }
                    }[site.status] || { bg: '#e2e3e5', color: '#383d41' };
                    
                    const validationColor = {
                        'pending': { bg: '#fff3cd', color: '#856404' },
                        'validated': { bg: '#d4edda', color: '#155724' },
                        'rejected': { bg: '#f8d7da', color: '#721c24' }
                    }[site.validation_status] || { bg: '#e2e3e5', color: '#383d41' };
                    
                    // Formater la date
                    const date = site.created_date ? 
                        new Date(site.created_date).toLocaleString(currentLang === 'ar' ? 'ar-DZ' : 'fr-FR', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }) : '—';
                    
                    html += `
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center; font-family: monospace;">
                                ${site.domain}
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                <span style="background: ${statusColor.bg}; color: ${statusColor.color}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    ${categoryName}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                <span style="background: ${statusColor.bg}; color: ${statusColor.color}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    ${statusName}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                <span style="background: ${validationColor.bg}; color: ${validationColor.color}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    ${validationName}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center; font-size: 13px;">
                                ${date}
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                ${site.reported_by}
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
            } catch (error) {
                console.error('Erreur chargement sites récents:', error);
                const tbody = document.getElementById('recentSitesTable');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="padding: 20px; text-align: center; color: #dc3545;">
                            ❌ ${currentLang === 'ar' ? 'خطأ في تحميل البيانات' : 'Erreur de chargement'}
                        </td>
                    </tr>
                `;
            }
        }

        // ==================== DICTIONNAIRES DE TRADUCTION ====================
        
        const translations = {
            ar: {
                categories: {
                    safe: 'آمن', education: 'تعليمي', kids: 'أطفال',
                    news: 'أخبار', social: 'شبكات اجتماعية', gaming: 'ألعاب',
                    shopping: 'تسوق', streaming: 'بث مباشر', government: 'حكومي',
                    banking: 'بنوك', religion: 'ديني', health: 'صحة',
                    sports: 'رياضة', entertainment: 'ترفيه', adult: 'محتوى بالغين',
                    violence: 'عنف', gambling: 'قمار', drugs: 'مخدرات',
                    malware: 'برمجيات خبيثة', phishing: 'احتيال',
                    hate: 'خطاب كراهية', weapons: 'أسلحة'
                },
                statuses: {
                    safe: 'آمن', warning: 'تحذير', danger: 'خطير',
                    pending: 'قيد المراجعة', validated: 'تم التحقق', rejected: 'مرفوض'
                },
                descriptions: {
                    education: "مواقع تعليمية تحتوي على دروس، محاضرات، كتب إلكترونية.",
                    kids: "مواقع مخصصة للأطفال مع محتوى آمن ومناسب للأعمار الصغيرة.",
                    news: "مواقع الأخبار والصحافة.",
                    social: "شبكات التواصل الاجتماعي.",
                    gaming: "مواقع الألعاب الإلكترونية.",
                    adult: "محتوى للبالغين فقط.",
                    violence: "مواقع تحتوي على مشاهد عنف.",
                    gambling: "مواقع القمار والمراهنات.",
                    drugs: "مواقع تروج للمخدرات أو الكحول.",
                    shopping: "مواقع التسوق الإلكتروني.",
                    streaming: "مواقع البث المباشر للفيديو.",
                    government: "مواقع حكومية رسمية.",
                    banking: "مواقع البنوك والمؤسسات المالية.",
                    religion: "مواقع دينية.",
                    health: "مواقع طبية وصحية."
                }
            },
            fr: {
                categories: {
                    safe: 'Sûr', education: 'Éducatif', kids: 'Enfants',
                    news: 'Actualités', social: 'Réseaux sociaux', gaming: 'Jeux',
                    shopping: 'Shopping', streaming: 'Streaming', government: 'Gouvernemental',
                    banking: 'Banques', religion: 'Religieux', health: 'Santé',
                    sports: 'Sports', entertainment: 'Divertissement', adult: 'Contenu adulte',
                    violence: 'Violence', gambling: "Jeux d'argent", drugs: 'Drogues',
                    malware: 'Malware', phishing: 'Hameçonnage',
                    hate: 'Discours haineux', weapons: 'Armes'
                },
                statuses: {
                    safe: 'Sûr', warning: 'Attention', danger: 'Dangereux',
                    pending: 'En révision', validated: 'Validé', rejected: 'Rejeté'
                },
                descriptions: {
                    education: "Sites éducatifs avec cours, conférences, livres.",
                    kids: "Sites pour enfants avec contenu adapté.",
                    news: "Sites d'actualités et journalisme.",
                    social: "Réseaux sociaux.",
                    gaming: "Sites de jeux vidéo.",
                    adult: "Contenu pour adultes.",
                    violence: "Sites avec violence.",
                    gambling: "Sites de jeux d'argent.",
                    drugs: "Sites faisant la promotion de drogues.",
                    shopping: "Sites de commerce électronique.",
                    streaming: "Sites de diffusion vidéo.",
                    government: "Sites gouvernementaux.",
                    banking: "Sites bancaires.",
                    religion: "Sites religieux.",
                    health: "Sites médicaux."
                }
            }
        };

        let selectedTarget = null;

        // ==================== ANALYSE INTELLIGENTE D'URL ====================
        
        function parseURL(input) {
            try {
                input = input.trim().toLowerCase();
                
                if (!input.match(/^https?:\/\//)) {
                    input = 'https://' + input;
                }
                
                const url = new URL(input);
                const hostname = url.hostname.replace(/^www\./, '');
                const parts = hostname.split('.');
                
                let mainDomain, subdomain;
                
                if (parts.length >= 2) {
                    mainDomain = parts.slice(-2).join('.');
                    if (parts.length > 2) {
                        subdomain = parts.slice(0, -2).join('.');
                    } else {
                        subdomain = null;
                    }
                } else {
                    mainDomain = hostname;
                    subdomain = null;
                }
                
                const path = url.pathname !== '/' ? url.pathname : null;
                
                return {
                    full: hostname,
                    mainDomain: mainDomain,
                    subdomain: subdomain,
                    fullSubdomain: subdomain ? `${subdomain}.${mainDomain}` : null,
                    path: path,
                    original: input
                };
            } catch (e) {
                return null;
            }
        }

        // ==================== ÉCOUTER LES CHANGEMENTS D'URL ====================
        
        document.getElementById('domainInput').addEventListener('input', function(e) {
            const parsed = parseURL(e.target.value);
            
            if (!parsed) {
                document.getElementById('urlPreview').style.display = 'none';
                return;
            }
            
            document.getElementById('urlPreview').style.display = 'block';
            document.getElementById('mainDomain').textContent = parsed.mainDomain;
            document.getElementById('subdomain').textContent = parsed.subdomain || '(لا يوجد)';
            document.getElementById('urlPath').textContent = parsed.path || '(لا يوجد)';
            
            const optionsHTML = generateGranularityOptions(parsed);
            document.getElementById('granularityOptions').innerHTML = optionsHTML;
            
            selectDefaultOption(parsed);
        });

        function generateGranularityOptions(parsed) {
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            let html = '';
            
            // Option 1 : Domaine complet
            html += `
                <div class="granularity-option" data-target="${parsed.mainDomain}" data-level="domain">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <strong style="color: #d32f2f;">🌐 ${currentLang === 'ar' ? 'الموقع الكامل' : 'Site complet'}: ${parsed.mainDomain}</strong><br>
                            <small style="color: #666;">${currentLang === 'ar' ? 'سيحظر جميع الصفحات والنطاقات الفرعية' : 'Bloque tout le site'}</small>
                        </div>
                        <div style="background: #ffebee; padding: 8px 12px; border-radius: 6px; color: #c62828; font-weight: bold;">
                            ${currentLang === 'ar' ? 'عريض جداً' : 'Trop large'}
                        </div>
                    </div>
                </div>
            `;
            
            // Option 2 : Sous-domaine
            if (parsed.fullSubdomain) {
                html += `
                    <div class="granularity-option" data-target="${parsed.fullSubdomain}" data-level="subdomain">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong style="color: #f57c00;">📍 ${currentLang === 'ar' ? 'النطاق الفرعي' : 'Sous-domaine'}: ${parsed.fullSubdomain}</strong><br>
                                <small style="color: #666;">${currentLang === 'ar' ? 'سيحظر هذا النطاق الفرعي فقط' : 'Bloque seulement ce sous-domaine'}</small>
                            </div>
                            <div style="background: #fff3e0; padding: 8px 12px; border-radius: 6px; color: #e65100; font-weight: bold;">
                                ${currentLang === 'ar' ? 'موصى به' : 'Recommandé'}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Option 3 : Chemin
            if (parsed.path) {
                html += `
                    <div class="granularity-option" data-target="${parsed.full}${parsed.path}" data-level="path">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong style="color: #7b1fa2;">🎯 ${currentLang === 'ar' ? 'صفحة محددة' : 'Page spécifique'}: ${parsed.full}${parsed.path}</strong><br>
                                <small style="color: #666;">${currentLang === 'ar' ? 'سيحظر هذه الصفحة بالتحديد' : 'Bloque seulement cette page'}</small>
                            </div>
                            <div style="background: #f3e5f5; padding: 8px 12px; border-radius: 6px; color: #6a1b9a; font-weight: bold;">
                                ${currentLang === 'ar' ? 'دقيق جداً' : 'Très précis'}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return html;
        }

        function selectDefaultOption(parsed) {
            let defaultTarget;
            
            if (parsed.path) {
                defaultTarget = `${parsed.full}${parsed.path}`;
            } else if (parsed.fullSubdomain) {
                defaultTarget = parsed.fullSubdomain;
            } else {
                defaultTarget = parsed.mainDomain;
            }
            
            setTimeout(() => {
                const option = document.querySelector(`[data-target="${defaultTarget}"]`);
                if (option) option.click();
            }, 100);
        }

        // ==================== GESTION DES OPTIONS ====================
        
        document.addEventListener('click', function(e) {
            if (e.target.closest('.granularity-option')) {
                const option = e.target.closest('.granularity-option');
                const currentLang = document.documentElement.getAttribute('lang') || 'ar';
                
                document.querySelectorAll('.granularity-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                option.classList.add('selected');
                selectedTarget = option.dataset.target;
                
                const warningBox = document.getElementById('warningBox');
                const warningText = document.getElementById('warningText');
                
                if (option.dataset.level === 'domain') {
                    warningBox.style.display = 'block';
                    warningText.textContent = currentLang === 'ar' ? 
                        `تحظير ${selectedTarget} سيمنع الوصول لكل الموقع! تأكد أن هذا ما تريده.` :
                        `Bloquer ${selectedTarget} empêchera l'accès à tout le site !`;
                } else {
                    warningBox.style.display = 'none';
                }
            }
        });

        // ==================== DESCRIPTION CATÉGORIE ====================
        
        document.getElementById('categorySelect').addEventListener('change', function() {
            const category = this.value;
            const descDiv = document.getElementById('categoryDescription');
            const descText = document.getElementById('descriptionText');
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            
            if (category && translations[currentLang].descriptions[category]) {
                descText.textContent = translations[currentLang].descriptions[category];
                descDiv.style.display = 'block';
            } else {
                descDiv.style.display = 'none';
            }
        });

        // ==================== SOUMISSION DU FORMULAIRE ====================
        
        document.getElementById('siteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            
            if (!selectedTarget) {
                alert(currentLang === 'ar' ? 
                    '⚠️ يرجى اختيار ما تريد تصنيفه بالضبط' : 
                    '⚠️ Veuillez choisir ce que vous voulez catégoriser');
                return;
            }
            
            const category = document.getElementById('categorySelect').value;
            const reason = document.getElementById('reasonInput').value;
            const contributor = document.getElementById('contributorInput').value;
            const resultCard = document.getElementById('resultCard');
            
            resultCard.style.display = 'block';
            resultCard.innerHTML = '<div style="text-align: center; padding: 20px;"><b>⏳ ' + 
                (currentLang === 'ar' ? 'جاري الإرسال...' : 'Envoi en cours...') + 
                '</b></div>';
            
            try {
                const response = await fetch('https://api.dznet1.com/_/api/check_or_submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        domain: selectedTarget,
                        category: category,
                        reason: reason,
                        contributor: contributor
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    resultCard.innerHTML = `
                        <div style="background: #ffebee; padding: 20px; border-radius: 12px; color: #c62828;">
                            ❌ ${data.message || data.error}
                        </div>
                    `;
                    return;
                }
                
                displayResult(data);
                
                // ✨ NOUVEAU : Recharger les statistiques et la liste après ajout
                if (data.action === 'created') {
                    setTimeout(() => {
                        loadStatistics();
                        loadRecentSites();
                    }, 1000);
                }
                
            } catch (error) {
                console.error(error);
                resultCard.innerHTML = `
                    <div style="background: #ffebee; padding: 20px; border-radius: 12px; color: #c62828;">
                        ⚠️ ${currentLang === 'ar' ? 'خطأ في الاتصال بالخادم' : 'Erreur de connexion au serveur'}
                    </div>
                `;
            }
        });

        function displayResult(data) {
            const resultCard = document.getElementById('resultCard');
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            const t = translations[currentLang];
            
            const categoryName = t.categories[data.category] || data.category;
            const statusName = t.statuses[data.status] || data.status;
            const validationStatusName = t.statuses[data.validation_status] || data.validation_status;
            
            let message = '';
            if (data.action === 'found') {
                message = currentLang === 'ar' ? 
                    '✅ الموقع موجود في قاعدة البيانات' : 
                    '✅ Site trouvé dans la base de données';
            } else if (data.action === 'created') {
                message = currentLang === 'ar' ? 
                    '🎉 تم إضافة الموقع بنجاح! قيد المراجعة.' : 
                    '🎉 Site ajouté avec succès ! En cours de révision.';
            }
            
            resultCard.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 20px; text-align: right; direction: rtl;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: #004080;">🌐 ${data.domain}</h3>
                        <p style="color: #28a745; font-weight: bold;">${message}</p>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; font-size: 15px;">
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">📁 ${currentLang === 'ar' ? 'الفئة' : 'Catégorie'}:</td>
                            <td style="padding: 8px;">${categoryName}</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">📊 ${currentLang === 'ar' ? 'الحالة' : 'Statut'}:</td>
                            <td style="padding: 8px;">${statusName}</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">✅ ${currentLang === 'ar' ? 'حالة التحقق' : 'Validation'}:</td>
                            <td style="padding: 8px;">${validationStatusName}</td>
                        </tr>
                        ${data.description ? `
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">📝 ${currentLang === 'ar' ? 'الوصف' : 'Description'}:</td>
                            <td style="padding: 8px;">${data.description}</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">🛡️ ${currentLang === 'ar' ? 'مستوى الثقة' : 'Score'}:</td>
                            <td style="padding: 8px;">${data.trust_score}%</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">👤 ${currentLang === 'ar' ? 'المبلّغ' : 'Rapporté par'}:</td>
                            <td style="padding: 8px;">${data.reported_by || 'مجهول'}</td>
                        </tr>
                        ${data.created_date ? `
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">📅 ${currentLang === 'ar' ? 'تاريخ الإضافة' : 'Date'}:</td>
                            <td style="padding: 8px;">${new Date(data.created_date).toLocaleString(currentLang === 'ar' ? 'ar-DZ' : 'fr-FR')}</td>
                        </tr>
                        ` : ''}
                    </table>
                </div>
            `;
        }
    </script>
    </script>
</body>
</html>
