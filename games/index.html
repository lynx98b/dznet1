// Fonction optimisÃ©e pour trouver tous les logos en une seule passe
async function findAllGameLogos(filenames) {
    const logoPromises = [];
    
    filenames.forEach(filename => {
        const baseName = filename.replace('.html', '');
        
        imageExtensions.forEach(ext => {
            const imageUrl = `${baseName}${ext}`;
            logoPromises.push(
                checkImageExists(imageUrl).then(exists => ({
                    filename,
                    imageUrl,
                    exists
                }))
            );
        });
    });
    
    const results = await Promise.all(logoPromises);
    const logoMap = {};
    
    // Organiser les rÃ©sultats par fichier
    filenames.forEach(filename => {
        logoMap[filename] = null;
    });
    
    results.forEach(({ filename, imageUrl, exists }) => {
        if (exists && !logoMap[filename]) {
            logoMap[filename] = imageUrl;
        }
    });
    
    return logoMap;
}

// Version optimisÃ©e du chargement
async function loadAllGamesOptimized() {
    const gamesGrid = document.getElementById('gamesGrid');
    
    try {
        // D'abord, trouver tous les logos
        const logoMap = await findAllGameLogos(gameFiles);
        
        // Ensuite, charger les infos des fichiers HTML
        const gamesPromises = gameFiles.map(async (filename) => {
            const response = await fetch(filename);
            const html = await response.text();
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            const title = doc.querySelector('title')?.textContent || 
                         filename.replace('.html', '').replace(/_/g, ' ');
            
            let description = doc.querySelector('meta[name="description"]')?.getAttribute('content') || '';
            
            if (!description) {
                const firstParagraph = doc.querySelector('p');
                if (firstParagraph) {
                    description = firstParagraph.textContent.substring(0, 120) + '...';
                } else {
                    description = "Jeu de culture gÃ©nÃ©rale - Testez vos connaissances";
                }
            }
            
            return {
                filename,
                title,
                description,
                url: filename,
                logoUrl: logoMap[filename]
            };
        });
        
        const games = await Promise.all(gamesPromises);
        
        // Afficher les jeux (mÃªme code d'affichage que prÃ©cÃ©demment)
        if (games.length === 0) {
            gamesGrid.innerHTML = '<div class="empty-state"><h2>Aucun jeu trouvÃ©</h2></div>';
            return;
        }
        
        gamesGrid.innerHTML = games.map(game => `
            <div class="game-card">
                <div class="game-icon">
                    ${game.logoUrl ? 
                        `<img src="${game.logoUrl}" alt="${game.title}">
                         <div class="default-icon" style="display:none;">ðŸŽ¯</div>` :
                        `<div class="default-icon">ðŸŽ¯</div>`
                    }
                </div>
                <div class="game-content">
                    <h3 class="game-title">${game.title}</h3>
                    <p class="game-description">${game.description}</p>
                    <a href="${game.url}" class="game-link">Jouer maintenant</a>
                    <div class="file-name">${game.filename}</div>
                </div>
            </div>
        `).join('');
        
    } catch (error) {
        console.error('Erreur:', error);
        gamesGrid.innerHTML = '<div class="empty-state"><h2>Erreur de chargement</h2></div>';
    }
}
