<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CRRK6Z4D1X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CRRK6Z4D1X');
  </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histoires et Livres - Espace Enfants</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
        }
        
        body {
            background: linear-gradient(135deg, #e0f7fa 0%, #bbdefb 100%);
            color: #333;
            min-height: 1080px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1920px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: 1080px;
        }
        
        /* ZONE EN-T√äTE (BUB) */
        .zone-entete-bub {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            border-bottom: 5px solid #ff6b6b;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .zone-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icone {
            font-size: 36px;
            color: #ff6b6b;
        }
        
        .texte-logo {
            font-size: 28px;
            font-weight: bold;
            color: #5a189a;
            text-shadow: 2px 2px 0px #ffd166;
        }
        
        .zone-navigation {
            display: flex;
            gap: 20px;
        }
        
        .bouton-navigation {
            background: #4361ee;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #3a56d4;
        }
        
        .bouton-navigation:hover {
            background: #3a56d4;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #3a56d4;
        }
        
        /* ZONE TITRE PRINCIPAL */
        .zone-titre-principal {
            background-color: #ffd166;
            padding: 20px 0;
            text-align: center;
            border-bottom: 5px dashed #ff9e00;
        }
        
        .zone-titre-principal h1 {
            font-size: 42px;
            color: #5a189a;
            text-shadow: 3px 3px 0px #ff9e00;
            margin-bottom: 10px;
        }
        
        .zone-titre-principal p {
            font-size: 20px;
            color: #ef476f;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* ZONE RECHERCHE ET FILTRES */
        .zone-recherche-filtres {
            background: white;
            padding: 20px 30px;
            border-bottom: 3px solid #4cc9f0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            align-items: center;
        }
        
        .zone-recherche {
            display: flex;
            gap: 10px;
            flex: 1;
            max-width: 400px;
        }
        
        .champ-recherche {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #4cc9f0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }
        
        .bouton-recherche {
            background: #4cc9f0;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .bouton-recherche:hover {
            background: #3ab0d6;
        }
        
        .bouton-filtre {
            background: #f8f9fa;
            border: 2px solid #4cc9f0;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            color: #4361ee;
        }
        
        .bouton-filtre.actif {
            background: #4cc9f0;
            color: white;
        }
        
        .bouton-filtre:hover {
            background: #4cc9f0;
            color: white;
        }
        
        .stats {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            font-size: 18px;
            color: #5a189a;
        }
        
        /* ZONE CONTENU PRINCIPAL */
        .zone-contenu-principal {
            flex: 1;
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }
        
        /* Section livres */
        .section-livres {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border: 4px solid #ff9e00;
        }
        
        .section-livres h2 {
            font-size: 32px;
            color: #5a189a;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 2px 2px 0px #ffd166;
        }
        
        .grille-livres {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }
        
        .carte-livre {
            background: #f8f9fa;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
        }
        
        .carte-livre:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.15);
            border-color: #4cc9f0;
        }
        
        .image-livre {
            height: 200px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 60px;
            position: relative;
            overflow: hidden;
        }
        
        .image-livre img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .default-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .contenu-livre {
            padding: 20px;
        }
        
        .contenu-livre h3 {
            font-size: 20px;
            color: #5a189a;
            margin-bottom: 10px;
        }
        
        .contenu-livre p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .metadonnees {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .badge-age {
            background: #ef476f;
            color: white;
        }
        
        .badge-categorie {
            background: #06d6a0;
            color: white;
        }
        
        .badge-type {
            background: #118ab2;
            color: white;
        }
        
        .etoiles {
            color: #ff9e00;
            margin-bottom: 10px;
        }
        
        .bouton-lire {
            background: #06d6a0;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
        }
        
        .bouton-lire:hover {
            background: #05b989;
        }
        
        .file-name {
            font-size: 0.9rem;
            color: #999;
            margin-top: 10px;
            font-family: monospace;
            text-align: center;
        }
        
        /* √âtats de chargement et erreur */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 18px;
        }
        
        .error-state {
            text-align: center;
            padding: 40px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            margin: 20px;
            color: #856404;
        }
        
        /* ZONE PIED DE PAGE */
        .zone-pied-page {
            background: linear-gradient(135deg, #5a189a 0%, #7b2cbf 100%);
            color: white;
            padding: 30px 40px 20px;
            border-top: 8px solid #ff9e00;
        }
        
        .contenu-pied-page {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .info-contact {
            flex: 1;
            min-width: 300px;
        }
        
        .info-contact h3 {
            font-size: 22px;
            margin-bottom: 15px;
            color: #ffd166;
        }
        
        .info-contact p {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .liens-rapides {
            flex: 1;
            min-width: 200px;
        }
        
        .liens-rapides h3 {
            font-size: 22px;
            margin-bottom: 15px;
            color: #ffd166;
        }
        
        .liens-rapides ul {
            list-style: none;
        }
        
        .liens-rapides li {
            margin-bottom: 10px;
        }
        
        .liens-rapides a {
            color: white;
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s;
        }
        
        .liens-rapides a:hover {
            color: #ffd166;
        }
        
        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #9d4edd;
            color: #e0aaff;
            font-size: 14px;
            width: 100%;
        }
        
        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .flottant {
            animation: float 5s ease-in-out infinite;
        }
        
        /* Responsive */
        @media (max-width: 1400px) {
            .grille-livres {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .zone-entete-bub {
                flex-direction: column;
                height: auto;
                padding: 15px;
            }
            
            .zone-navigation {
                margin-top: 15px;
            }
            
            .zone-recherche-filtres {
                flex-direction: column;
            }
            
            .zone-recherche {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ZONE EN-T√äTE (BUB) -->
        <header class="zone-entete-bub">
            <div class="zone-logo">
                <div class="logo-icone flottant">
                    <i class="fas fa-book-open"></i>
                </div>
                <div class="texte-logo">Histoires et Livres</div>
            </div>
            <div class="zone-navigation">
                <button class="bouton-navigation" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i> Accueil
                </button>
                <button class="bouton-navigation">
                    <i class="fas fa-user"></i> Mon Compte
                </button>
            </div>
        </header>
        
        <!-- ZONE TITRE PRINCIPAL -->
        <section class="zone-titre-principal">
            <h1>Biblioth√®que Magique</h1>
            <p>D√©couvre des histoires captivantes, des livres interactifs et des contes audio!</p>
        </section>
        
        <!-- ZONE RECHERCHE ET FILTRES -->
        <section class="zone-recherche-filtres">
            <div class="zone-recherche">
                <input type="text" class="champ-recherche" id="champRecherche" placeholder="Rechercher une histoire...">
                <button class="bouton-recherche" id="boutonRecherche">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <button class="bouton-filtre actif" data-filtre="all">Tous</button>
            <button class="bouton-filtre" data-filtre="age-3-5">3-5 ans</button>
            <button class="bouton-filtre" data-filtre="age-6-8">6-8 ans</button>
            <button class="bouton-filtre" data-filtre="age-9-12">9-12 ans</button>
            <button class="bouton-filtre" data-filtre="categorie-contes">Contes</button>
            <button class="bouton-filtre" data-filtre="categorie-aventures">Aventures</button>
            <button class="bouton-filtre" data-filtre="categorie-animaux">Animaux</button>
        </section>
        
        <div class="stats" id="stats">
            <span id="livreCount">Scan des histoires en cours...</span>
        </div>
        
        <!-- ZONE CONTENU PRINCIPAL -->
        <main class="zone-contenu-principal">
            <!-- Section livres -->
            <section class="section-livres">
                <h2>Nos Histoires</h2>
                <div class="grille-livres" id="grilleLivres">
                    <div class="loading">
                        <p>Recherche automatique des histoires...</p>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- ZONE PIED DE PAGE -->
        <footer class="zone-pied-page">
            <div class="contenu-pied-page">
                <div class="info-contact">
                    <h3>Contact</h3>
                    <p><i class="fas fa-envelope"></i> enfants@monintranet.fr</p>
                    <p><i class="fas fa-phone"></i> 01 23 45 67 89</p>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Rue des Enfants, Paris</p>
                </div>
                
                <div class="liens-rapides">
                    <h3>Liens Rapides</h3>
                    <ul>
                        <li><a href="index.html">Retour √† l'accueil</a></li>
                        <li><a href="#">Jeux √âducatifs</a></li>
                        <li><a href="#">Atelier Cr√©atif</a></li>
                        <li><a href="#">Espace Musique</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2023 Espace Enfants - Tous droits r√©serv√©s | Con√ßu avec <i class="fas fa-heart" style="color:#ff6b6b"></i> pour les enfants
            </div>
        </footer>
    </div>

    <script>
        // Configuration
        const EXCLUDED_FILES = ['index.html', 'sommaire.html', 'histoires.html']; // Fichiers √† ignorer
        const imageExtensions = ['.jpg', '.jpeg', '.png', '.webp', '.gif'];
        
        // √âtat des filtres
        let filtresActifs = {
            age: 'all',
            categorie: 'all',
            recherche: ''
        };
        
        let toutesLesHistoires = [];

        // Fonction pour d√©tecter tous les fichiers HTML du dossier
        async function discoverHTMLFiles() {
            try {
                console.log('üîç D√©but du scan des fichiers HTML...');
                
                // Strat√©gie 1: Essayer de r√©cup√©rer la liste via fetch (pour GitHub Pages)
                let allFiles = [];
                
                try {
                    // Cette m√©thode fonctionne sur certains serveurs
                    const response = await fetch('./');
                    const text = await response.text();
                    
                    // Parser le HTML de la page d'index pour trouver les liens
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const links = doc.querySelectorAll('a[href$=".html"]');
                    
                    allFiles = Array.from(links)
                        .map(link => link.getAttribute('href'))
                        .filter(file => !EXCLUDED_FILES.includes(file));
                        
                    console.log(`üìÅ Fichiers trouv√©s via scan:`, allFiles);
                    
                } catch (error) {
                    console.log('‚ùå Scan automatique √©chou√©, utilisation de la d√©tection par pattern');
                }
                
                // Si pas de fichiers trouv√©s, utiliser la d√©tection par pattern
                if (allFiles.length === 0) {
                    allFiles = await detectFilesByPattern();
                }
                
                return allFiles;
                
            } catch (error) {
                console.error('Erreur lors de la d√©couverte des fichiers:', error);
                return [];
            }
        }

        // Fonction pour d√©tecter les fichiers par pattern (histoire1, histoire2, etc.)
        async function detectFilesByPattern() {
            console.log('üéØ D√©tection par pattern...');
            const patterns = [
                'histoire', 'hist', 'conte', 'livre', 'story'
            ];
            
            const discoveredFiles = [];
            
            // Tester les patterns avec num√©ros (histoire1.html, histoire2.html, etc.)
            for (let i = 0; i <= 20; i++) {
                for (const pattern of patterns) {
                    const filename = `${pattern}${i}.html`;
                    if (await fileExists(filename)) {
                        discoveredFiles.push(filename);
                        console.log(`‚úÖ Trouv√©: ${filename}`);
                    }
                }
            }
            
            // Tester les patterns sans num√©ros
            for (const pattern of patterns) {
                const filename = `${pattern}.html`;
                if (await fileExists(filename)) {
                    discoveredFiles.push(filename);
                    console.log(`‚úÖ Trouv√©: ${filename}`);
                }
            }
            
            // Chercher aussi les fichiers avec underscores
            for (const pattern of patterns) {
                const variations = ['aventure', 'conte', 'animaux', 'magique', 'dragon', 'princesse'];
                for (const variation of variations) {
                    const filename = `${pattern}_${variation}.html`;
                    if (await fileExists(filename)) {
                        discoveredFiles.push(filename);
                        console.log(`‚úÖ Trouv√©: ${filename}`);
                    }
                }
            }
            
            return discoveredFiles;
        }

        // Fonction pour v√©rifier si un fichier existe
        async function fileExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // Fonction pour v√©rifier si une image existe
        function checkImageExists(imageUrl) {
            return new Promise((resolve) => {
                const img = new Image();
                const timeout = setTimeout(() => resolve(false), 2000);
                
                img.onload = () => {
                    clearTimeout(timeout);
                    resolve(true);
                };
                img.onerror = () => {
                    clearTimeout(timeout);
                    resolve(false);
                };
                img.src = imageUrl;
            });
        }

        // Fonction pour trouver le logo d'une histoire
        async function findStoryLogo(baseFilename) {
            const baseName = baseFilename.replace('.html', '');
            
            // Tester toutes les extensions d'image
            for (const ext of imageExtensions) {
                const imageUrl = `${baseName}${ext}`;
                const exists = await checkImageExists(imageUrl);
                if (exists) {
                    return imageUrl;
                }
            }
            
            return null;
        }

        // Fonction pour extraire les m√©tadonn√©es d'un fichier HTML
        async function extractFileInfo(filename) {
            try {
                const response = await fetch(filename);
                const html = await response.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Extraire le titre
                const title = doc.querySelector('title')?.textContent || 
                             filename.replace('.html', '')
                                    .replace(/_/g, ' ')
                                    .replace(/([a-z])([A-Z])/g, '$1 $2')
                                    .replace(/\b\w/g, l => l.toUpperCase());
                
                // Extraire la description
                let description = doc.querySelector('meta[name="description"]')?.getAttribute('content') || '';
                
                if (!description) {
                    const firstParagraph = doc.querySelector('p');
                    if (firstParagraph) {
                        description = firstParagraph.textContent.substring(0, 120) + '...';
                    } else {
                        const firstH1 = doc.querySelector('h1');
                        description = firstH1 ? firstH1.textContent + " - Histoire pour enfants" : "Histoire pour enfants";
                    }
                }
                
                // Extraire les m√©tadonn√©es personnalis√©es
                const age = doc.querySelector('meta[name="age"]')?.getAttribute('content') || '3-5';
                const categorie = doc.querySelector('meta[name="categorie"]')?.getAttribute('content') || 'contes';
                const type = doc.querySelector('meta[name="type"]')?.getAttribute('content') || 'histoire';
                
                // Chercher le logo
                const logoUrl = await findStoryLogo(filename);
                
                return {
                    filename,
                    title,
                    description,
                    url: filename,
                    logoUrl,
                    age,
                    categorie,
                    type
                };
            } catch (error) {
                console.error(`Erreur avec ${filename}:`, error);
                return {
                    filename,
                    title: filename.replace('.html', '')
                                  .replace(/_/g, ' ')
                                  .replace(/([a-z])([A-Z])/g, '$1 $2')
                                  .replace(/\b\w/g, l => l.toUpperCase()),
                    description: "Histoire pour enfants",
                    url: filename,
                    logoUrl: null,
                    age: '3-5',
                    categorie: 'contes',
                    type: 'histoire'
                };
            }
        }

        // Fonction pour filtrer les histoires
        function filtrerHistoires(histoires) {
            return histoires.filter(histoire => {
                // Filtre par √¢ge
                if (filtresActifs.age !== 'all' && !histoire.age.includes(filtresActifs.age.replace('age-', ''))) {
                    return false;
                }
                
                // Filtre par cat√©gorie
                if (filtresActifs.categorie !== 'all' && !histoire.categorie.includes(filtresActifs.categorie.replace('categorie-', ''))) {
                    return false;
                }
                
                // Filtre par recherche
                if (filtresActifs.recherche) {
                    const termeRecherche = filtresActifs.recherche.toLowerCase();
                    return histoire.title.toLowerCase().includes(termeRecherche) || 
                           histoire.description.toLowerCase().includes(termeRecherche);
                }
                
                return true;
            });
        }

        // Fonction pour afficher les histoires
        function afficherHistoires(histoires) {
            const grilleLivres = document.getElementById('grilleLivres');
            const statsElement = document.getElementById('livreCount');
            
            if (histoires.length === 0) {
                grilleLivres.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book" style="font-size: 50px; margin-bottom: 20px; color: #ccc;"></i>
                        <h3>Aucune histoire trouv√©e</h3>
                        <p>Aucune histoire ne correspond √† vos crit√®res de recherche.</p>
                        <p>Essayez de modifier vos filtres ou votre recherche.</p>
                    </div>
                `;
                statsElement.textContent = `üìö 0 histoire(s) trouv√©e(s)`;
                return;
            }
            
            // Trier par nom de fichier
            histoires.sort((a, b) => a.filename.localeCompare(b.filename));
            
            // Mettre √† jour les statistiques
            const histoiresAvecLogos = histoires.filter(histoire => histoire.logoUrl).length;
            statsElement.textContent = `üìö ${histoires.length} histoire(s) trouv√©e(s) ‚Ä¢ üñºÔ∏è ${histoiresAvecLogos} avec illustration`;
            
            // Afficher les histoires
            grilleLivres.innerHTML = histoires.map(histoire => `
                <div class="carte-livre" onclick="window.location.href='${histoire.url}'">
                    <div class="image-livre">
                        ${histoire.logoUrl ? 
                            `<img src="${histoire.logoUrl}" alt="${histoire.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                             <div class="default-icon" style="display:none;">üìñ</div>` :
                            `<div class="default-icon">üìñ</div>`
                        }
                    </div>
                    <div class="contenu-livre">
                        <h3 class="game-title">${histoire.title}</h3>
                        <div class="metadonnees">
                            <span class="badge badge-age">${histoire.age} ans</span>
                            <span class="badge badge-categorie">${histoire.categorie}</span>
                            <span class="badge badge-type">${histoire.type}</span>
                        </div>
                        <p class="game-description">${histoire.description}</p>
                        <a href="${histoire.url}" class="bouton-lire">Lire l'histoire</a>
                        <div class="file-name">${histoire.filename}</div>
                    </div>
                </div>
            `).join('');
        }

        // Fonction principale
        async function loadAllStoriesAutomatically() {
            const grilleLivres = document.getElementById('grilleLivres');
            const statsElement = document.getElementById('livreCount');
            
            try {
                statsElement.textContent = 'üîç Recherche des fichiers HTML...';
                
                // D√©couvrir automatiquement les fichiers
                const discoveredFiles = await discoverHTMLFiles();
                
                if (discoveredFiles.length === 0) {
                    statsElement.textContent = '‚ùå Aucun fichier HTML trouv√©';
                    grilleLivres.innerHTML = `
                        <div class="error-state">
                            <h2>Aucune histoire trouv√©e</h2>
                            <p>Le syst√®me n'a pas pu d√©tecter automatiquement les fichiers HTML.</p>
                            <p>V√©rifiez que vos fichiers suivent la convention de nommage (histoire1.html, histoire2.html, etc.)</p>
                        </div>
                    `;
                    return;
                }
                
                statsElement.textContent = `üìÅ ${discoveredFiles.length} histoire(s) d√©tect√©e(s) - Chargement...`;
                
                // Charger les informations de chaque fichier
                const storiesPromises = discoveredFiles.map(extractFileInfo);
                toutesLesHistoires = await Promise.all(storiesPromises);
                
                // Afficher toutes les histoires initialement
                afficherHistoires(toutesLesHistoires);
                
            } catch (error) {
                console.error('Erreur g√©n√©rale:', error);
                statsElement.textContent = '‚ùå Erreur lors du chargement';
                grilleLivres.innerHTML = `
                    <div class="error-state">
                        <h2>Erreur de chargement</h2>
                        <p>Une erreur est survenue lors de la d√©tection automatique des histoires.</p>
                        <p>V√©rifiez la console pour plus de d√©tails.</p>
                    </div>
                `;
            }
        }

        // Gestion des filtres
        document.querySelectorAll('.bouton-filtre').forEach(bouton => {
            bouton.addEventListener('click', function() {
                // Mettre √† jour l'√©tat actif
                document.querySelectorAll('.bouton-filtre').forEach(btn => {
                    btn.classList.remove('actif');
                });
                this.classList.add('actif');
                
                // Mettre √† jour les filtres
                const filtre = this.getAttribute('data-filtre');
                if (filtre.startsWith('age-')) {
                    filtresActifs.age = filtre;
                } else if (filtre.startsWith('categorie-')) {
                    filtresActifs.categorie = filtre;
                } else if (filtre === 'all') {
                    filtresActifs.age = 'all';
                    filtresActifs.categorie = 'all';
                }
                
                // Appliquer les filtres
                const histoiresFiltrees = filtrerHistoires(toutesLesHistoires);
                afficherHistoires(histoiresFiltrees);
            });
        });

        // Gestion de la recherche
        document.getElementById('boutonRecherche').addEventListener('click', function() {
            filtresActifs.recherche = document.getElementById('champRecherche').value;
            const histoiresFiltrees = filtrerHistoires(toutesLesHistoires);
            afficherHistoires(histoiresFiltrees);
        });

        document.getElementById('champRecherche').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                filtresActifs.recherche = this.value;
                const histoiresFiltrees = filtrerHistoires(toutesLesHistoires);
                afficherHistoires(histoiresFiltrees);
            }
        });

        // D√©marrer automatiquement au chargement
        document.addEventListener('DOMContentLoaded', loadAllStoriesAutomatically);
    </script>
</body>
</html>
