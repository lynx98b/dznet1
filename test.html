<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DzNet1 - Ø£Ø¯Ø§Ø© Ø§Ù„ØªØµÙ†ÙŠÙ</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .url-helper {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .url-preview {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }
        .url-examples {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .granularity-option {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        .granularity-option:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        .granularity-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Toggle Language -->
    <div class="lang-toggle" onclick="toggleLanguage()">
        <span id="langText">ğŸ‡©ğŸ‡¿ FranÃ§ais</span>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                <span class="logo-icon"></span>
                <span class="logo-text">
                    <span class="dz">Dz</span><span class="net">Net1</span><span class="com">.com</span>
                </span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link" data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-fr="Accueil">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="filtres.html" class="nav-link" data-ar="Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØ©" data-fr="Filtres Communautaires">Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØ©</a></li>
                <li><a href="enfants.html" class="nav-link" data-ar="Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„" data-fr="Portail Enfants">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„</a></li>
                <li><a href="faq.html" class="nav-link" data-ar="Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©" data-fr="FAQ">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</a></li>
                <li><a href="categorisation.html" class="nav-link active" data-ar="Ø§Ù„ØªØµÙ†ÙŠÙ" data-fr="CatÃ©gorisation">Ø§Ù„ØªØµÙ†ÙŠÙ</a></li>
                <li><a href="contact.html" class="nav-link" data-ar="Ø§ØªØµÙ„ Ø¨Ù†Ø§" data-fr="Contact">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero">
        <h1>
            <span class="hero-icon" style="font-size: 48px;">ğŸ”</span>
            <span data-ar="Ø£Ø¯Ø§Ø© Ø§Ù„ØªØµÙ†ÙŠÙ" data-fr="Outil de CatÃ©gorisation">Ø£Ø¯Ø§Ø© Ø§Ù„ØªØµÙ†ÙŠÙ</span>
        </h1>
        <p data-ar="Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙÙŠ ØªØµÙ†ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙÙŠ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©" data-fr="Aidez la communautÃ© Ã  classer les sites web dans les bonnes catÃ©gories">Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙÙŠ ØªØµÙ†ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙÙŠ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</p>
    </div>

    <!-- Hero Section -->
<div class="hero">
    <h1>
        <span class="hero-icon" style="font-size: 48px;">ğŸ”</span>
        <span data-ar="Ø£Ø¯Ø§Ø© Ø§Ù„ØªØµÙ†ÙŠÙ" data-fr="Outil de CatÃ©gorisation">Ø£Ø¯Ø§Ø© Ø§Ù„ØªØµÙ†ÙŠÙ</span>
    </h1>
    <p data-ar="Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙÙŠ ØªØµÙ†ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙÙŠ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©" data-fr="Aidez la communautÃ© Ã  classer les sites web dans les bonnes catÃ©gories">
        Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙÙŠ ØªØµÙ†ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙÙŠ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
    </p>
</div>

<div class="container">
    <!-- âœ… IntÃ©gration directe de ton application Anvil -->
    <div id="anvilAppContainer" style="text-align:center; margin:30px 0;">
        <iframe
            src="https://catdznet1.anvil.app/"
            style="width:100%; height:90vh; border:none; border-radius:15px; box-shadow:0 0 20px rgba(0,0,0,0.15);"
            allowfullscreen
            sandbox="allow-scripts allow-same-origin allow-forms"
        ></iframe>
    </div>
</div>

    <script src="script.js"></script>
    <script>
        // ==================== CHARGEMENT DES DONNÃ‰ES AU DÃ‰MARRAGE ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            loadStatistics();
            loadRecentSites();
        });

        // Charger les statistiques
        async function loadStatistics() {
            try {
                const response = await fetch('https://cat-dznet1.anvil.app/_/api/stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalSites').textContent = data.total.toLocaleString('fr-FR');
                    document.getElementById('safeSites').textContent = data.by_status.safe.toLocaleString('fr-FR');
                    document.getElementById('warningSites').textContent = data.by_status.warning.toLocaleString('fr-FR');
                    document.getElementById('dangerSites').textContent = data.by_status.danger.toLocaleString('fr-FR');
                    document.getElementById('pendingSites').textContent = data.pending_validation.toLocaleString('fr-FR');
                }
            } catch (error) {
                console.error('Erreur chargement stats:', error);
            }
        }

        // Charger les derniers sites
        async function loadRecentSites() {
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            const t = translations[currentLang];
            
            try {
                const response = await fetch('https://cat-dznet1.anvil.app/_/api/recent_sites');
                const data = await response.json();
                
                const tbody = document.getElementById('recentSitesTable');
                
                if (!data.success || data.sites.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="padding: 20px; text-align: center; color: #999;">
                                ${currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ù‚Ø¹ Ø¨Ø¹Ø¯' : 'Aucun site pour le moment'}
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                data.sites.forEach(site => {
                    const categoryName = t.categories[site.category] || site.category;
                    const statusName = t.statuses[site.status] || site.status;
                    const validationName = t.statuses[site.validation_status] || site.validation_status;
                    
                    // Couleurs selon le statut
                    const statusColor = {
                        'safe': { bg: '#d4edda', color: '#155724' },
                        'warning': { bg: '#fff3cd', color: '#856404' },
                        'danger': { bg: '#f8d7da', color: '#721c24' }
                    }[site.status] || { bg: '#e2e3e5', color: '#383d41' };
                    
                    const validationColor = {
                        'pending': { bg: '#fff3cd', color: '#856404' },
                        'validated': { bg: '#d4edda', color: '#155724' },
                        'rejected': { bg: '#f8d7da', color: '#721c24' }
                    }[site.validation_status] || { bg: '#e2e3e5', color: '#383d41' };
                    
                    // Formater la date
                    const date = site.created_date ? 
                        new Date(site.created_date).toLocaleString(currentLang === 'ar' ? 'ar-DZ' : 'fr-FR', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }) : 'â€”';
                    
                    html += `
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center; font-family: monospace;">
                                ${site.domain}
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                <span style="background: ${statusColor.bg}; color: ${statusColor.color}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    ${categoryName}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                <span style="background: ${statusColor.bg}; color: ${statusColor.color}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    ${statusName}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                <span style="background: ${validationColor.bg}; color: ${validationColor.color}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    ${validationName}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center; font-size: 13px;">
                                ${date}
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6; text-align: center;">
                                ${site.reported_by}
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
            } catch (error) {
                console.error('Erreur chargement sites rÃ©cents:', error);
                const tbody = document.getElementById('recentSitesTable');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="padding: 20px; text-align: center; color: #dc3545;">
                            âŒ ${currentLang === 'ar' ? 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' : 'Erreur de chargement'}
                        </td>
                    </tr>
                `;
            }
        }

        // ==================== DICTIONNAIRES DE TRADUCTION ====================
        
        const translations = {
            ar: {
                categories: {
                    safe: 'Ø¢Ù…Ù†', education: 'ØªØ¹Ù„ÙŠÙ…ÙŠ', kids: 'Ø£Ø·ÙØ§Ù„',
                    news: 'Ø£Ø®Ø¨Ø§Ø±', social: 'Ø´Ø¨ÙƒØ§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', gaming: 'Ø£Ù„Ø¹Ø§Ø¨',
                    shopping: 'ØªØ³ÙˆÙ‚', streaming: 'Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±', government: 'Ø­ÙƒÙˆÙ…ÙŠ',
                    banking: 'Ø¨Ù†ÙˆÙƒ', religion: 'Ø¯ÙŠÙ†ÙŠ', health: 'ØµØ­Ø©',
                    sports: 'Ø±ÙŠØ§Ø¶Ø©', entertainment: 'ØªØ±ÙÙŠÙ‡', adult: 'Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„ØºÙŠÙ†',
                    violence: 'Ø¹Ù†Ù', gambling: 'Ù‚Ù…Ø§Ø±', drugs: 'Ù…Ø®Ø¯Ø±Ø§Øª',
                    malware: 'Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ø®Ø¨ÙŠØ«Ø©', phishing: 'Ø§Ø­ØªÙŠØ§Ù„',
                    hate: 'Ø®Ø·Ø§Ø¨ ÙƒØ±Ø§Ù‡ÙŠØ©', weapons: 'Ø£Ø³Ù„Ø­Ø©'
                },
                statuses: {
                    safe: 'Ø¢Ù…Ù†', warning: 'ØªØ­Ø°ÙŠØ±', danger: 'Ø®Ø·ÙŠØ±',
                    pending: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', validated: 'ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚', rejected: 'Ù…Ø±ÙÙˆØ¶'
                },
                descriptions: {
                    education: "Ù…ÙˆØ§Ù‚Ø¹ ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¯Ø±ÙˆØ³ØŒ Ù…Ø­Ø§Ø¶Ø±Ø§ØªØŒ ÙƒØªØ¨ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©.",
                    kids: "Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø®ØµØµØ© Ù„Ù„Ø£Ø·ÙØ§Ù„ Ù…Ø¹ Ù…Ø­ØªÙˆÙ‰ Ø¢Ù…Ù† ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø£Ø¹Ù…Ø§Ø± Ø§Ù„ØµØºÙŠØ±Ø©.",
                    news: "Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„ØµØ­Ø§ÙØ©.",
                    social: "Ø´Ø¨ÙƒØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ.",
                    gaming: "Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©.",
                    adult: "Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ø¨Ø§Ù„ØºÙŠÙ† ÙÙ‚Ø·.",
                    violence: "Ù…ÙˆØ§Ù‚Ø¹ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ù‡Ø¯ Ø¹Ù†Ù.",
                    gambling: "Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù‚Ù…Ø§Ø± ÙˆØ§Ù„Ù…Ø±Ø§Ù‡Ù†Ø§Øª.",
                    drugs: "Ù…ÙˆØ§Ù‚Ø¹ ØªØ±ÙˆØ¬ Ù„Ù„Ù…Ø®Ø¯Ø±Ø§Øª Ø£Ùˆ Ø§Ù„ÙƒØ­ÙˆÙ„.",
                    shopping: "Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.",
                    streaming: "Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„ÙÙŠØ¯ÙŠÙˆ.",
                    government: "Ù…ÙˆØ§Ù‚Ø¹ Ø­ÙƒÙˆÙ…ÙŠØ© Ø±Ø³Ù…ÙŠØ©.",
                    banking: "Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©.",
                    religion: "Ù…ÙˆØ§Ù‚Ø¹ Ø¯ÙŠÙ†ÙŠØ©.",
                    health: "Ù…ÙˆØ§Ù‚Ø¹ Ø·Ø¨ÙŠØ© ÙˆØµØ­ÙŠØ©."
                }
            },
            fr: {
                categories: {
                    safe: 'SÃ»r', education: 'Ã‰ducatif', kids: 'Enfants',
                    news: 'ActualitÃ©s', social: 'RÃ©seaux sociaux', gaming: 'Jeux',
                    shopping: 'Shopping', streaming: 'Streaming', government: 'Gouvernemental',
                    banking: 'Banques', religion: 'Religieux', health: 'SantÃ©',
                    sports: 'Sports', entertainment: 'Divertissement', adult: 'Contenu adulte',
                    violence: 'Violence', gambling: "Jeux d'argent", drugs: 'Drogues',
                    malware: 'Malware', phishing: 'HameÃ§onnage',
                    hate: 'Discours haineux', weapons: 'Armes'
                },
                statuses: {
                    safe: 'SÃ»r', warning: 'Attention', danger: 'Dangereux',
                    pending: 'En rÃ©vision', validated: 'ValidÃ©', rejected: 'RejetÃ©'
                },
                descriptions: {
                    education: "Sites Ã©ducatifs avec cours, confÃ©rences, livres.",
                    kids: "Sites pour enfants avec contenu adaptÃ©.",
                    news: "Sites d'actualitÃ©s et journalisme.",
                    social: "RÃ©seaux sociaux.",
                    gaming: "Sites de jeux vidÃ©o.",
                    adult: "Contenu pour adultes.",
                    violence: "Sites avec violence.",
                    gambling: "Sites de jeux d'argent.",
                    drugs: "Sites faisant la promotion de drogues.",
                    shopping: "Sites de commerce Ã©lectronique.",
                    streaming: "Sites de diffusion vidÃ©o.",
                    government: "Sites gouvernementaux.",
                    banking: "Sites bancaires.",
                    religion: "Sites religieux.",
                    health: "Sites mÃ©dicaux."
                }
            }
        };

        let selectedTarget = null;

        // ==================== ANALYSE INTELLIGENTE D'URL ====================
        
        function parseURL(input) {
            try {
                input = input.trim().toLowerCase();
                
                if (!input.match(/^https?:\/\//)) {
                    input = 'https://' + input;
                }
                
                const url = new URL(input);
                const hostname = url.hostname.replace(/^www\./, '');
                const parts = hostname.split('.');
                
                let mainDomain, subdomain;
                
                if (parts.length >= 2) {
                    mainDomain = parts.slice(-2).join('.');
                    if (parts.length > 2) {
                        subdomain = parts.slice(0, -2).join('.');
                    } else {
                        subdomain = null;
                    }
                } else {
                    mainDomain = hostname;
                    subdomain = null;
                }
                
                const path = url.pathname !== '/' ? url.pathname : null;
                
                return {
                    full: hostname,
                    mainDomain: mainDomain,
                    subdomain: subdomain,
                    fullSubdomain: subdomain ? `${subdomain}.${mainDomain}` : null,
                    path: path,
                    original: input
                };
            } catch (e) {
                return null;
            }
        }

        // ==================== Ã‰COUTER LES CHANGEMENTS D'URL ====================
        
        document.getElementById('domainInput').addEventListener('input', function(e) {
            const parsed = parseURL(e.target.value);
            
            if (!parsed) {
                document.getElementById('urlPreview').style.display = 'none';
                return;
            }
            
            document.getElementById('urlPreview').style.display = 'block';
            document.getElementById('mainDomain').textContent = parsed.mainDomain;
            document.getElementById('subdomain').textContent = parsed.subdomain || '(Ù„Ø§ ÙŠÙˆØ¬Ø¯)';
            document.getElementById('urlPath').textContent = parsed.path || '(Ù„Ø§ ÙŠÙˆØ¬Ø¯)';
            
            const optionsHTML = generateGranularityOptions(parsed);
            document.getElementById('granularityOptions').innerHTML = optionsHTML;
            
            selectDefaultOption(parsed);
        });

        function generateGranularityOptions(parsed) {
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            let html = '';
            
            // Option 1 : Domaine complet
            html += `
                <div class="granularity-option" data-target="${parsed.mainDomain}" data-level="domain">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <strong style="color: #d32f2f;">ğŸŒ ${currentLang === 'ar' ? 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒØ§Ù…Ù„' : 'Site complet'}: ${parsed.mainDomain}</strong><br>
                            <small style="color: #666;">${currentLang === 'ar' ? 'Ø³ÙŠØ­Ø¸Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª ÙˆØ§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©' : 'Bloque tout le site'}</small>
                        </div>
                        <div style="background: #ffebee; padding: 8px 12px; border-radius: 6px; color: #c62828; font-weight: bold;">
                            ${currentLang === 'ar' ? 'Ø¹Ø±ÙŠØ¶ Ø¬Ø¯Ø§Ù‹' : 'Trop large'}
                        </div>
                    </div>
                </div>
            `;
            
            // Option 2 : Sous-domaine
            if (parsed.fullSubdomain) {
                html += `
                    <div class="granularity-option" data-target="${parsed.fullSubdomain}" data-level="subdomain">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong style="color: #f57c00;">ğŸ“ ${currentLang === 'ar' ? 'Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ÙØ±Ø¹ÙŠ' : 'Sous-domaine'}: ${parsed.fullSubdomain}</strong><br>
                                <small style="color: #666;">${currentLang === 'ar' ? 'Ø³ÙŠØ­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ÙØ±Ø¹ÙŠ ÙÙ‚Ø·' : 'Bloque seulement ce sous-domaine'}</small>
                            </div>
                            <div style="background: #fff3e0; padding: 8px 12px; border-radius: 6px; color: #e65100; font-weight: bold;">
                                ${currentLang === 'ar' ? 'Ù…ÙˆØµÙ‰ Ø¨Ù‡' : 'RecommandÃ©'}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Option 3 : Chemin
            if (parsed.path) {
                html += `
                    <div class="granularity-option" data-target="${parsed.full}${parsed.path}" data-level="path">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong style="color: #7b1fa2;">ğŸ¯ ${currentLang === 'ar' ? 'ØµÙØ­Ø© Ù…Ø­Ø¯Ø¯Ø©' : 'Page spÃ©cifique'}: ${parsed.full}${parsed.path}</strong><br>
                                <small style="color: #666;">${currentLang === 'ar' ? 'Ø³ÙŠØ­Ø¸Ø± Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ¯' : 'Bloque seulement cette page'}</small>
                            </div>
                            <div style="background: #f3e5f5; padding: 8px 12px; border-radius: 6px; color: #6a1b9a; font-weight: bold;">
                                ${currentLang === 'ar' ? 'Ø¯Ù‚ÙŠÙ‚ Ø¬Ø¯Ø§Ù‹' : 'TrÃ¨s prÃ©cis'}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return html;
        }

        function selectDefaultOption(parsed) {
            let defaultTarget;
            
            if (parsed.path) {
                defaultTarget = `${parsed.full}${parsed.path}`;
            } else if (parsed.fullSubdomain) {
                defaultTarget = parsed.fullSubdomain;
            } else {
                defaultTarget = parsed.mainDomain;
            }
            
            setTimeout(() => {
                const option = document.querySelector(`[data-target="${defaultTarget}"]`);
                if (option) option.click();
            }, 100);
        }

        // ==================== GESTION DES OPTIONS ====================
        
        document.addEventListener('click', function(e) {
            if (e.target.closest('.granularity-option')) {
                const option = e.target.closest('.granularity-option');
                const currentLang = document.documentElement.getAttribute('lang') || 'ar';
                
                document.querySelectorAll('.granularity-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                option.classList.add('selected');
                selectedTarget = option.dataset.target;
                
                const warningBox = document.getElementById('warningBox');
                const warningText = document.getElementById('warningText');
                
                if (option.dataset.level === 'domain') {
                    warningBox.style.display = 'block';
                    warningText.textContent = currentLang === 'ar' ? 
                        `ØªØ­Ø¸ÙŠØ± ${selectedTarget} Ø³ÙŠÙ…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù„ÙƒÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹! ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ù…Ø§ ØªØ±ÙŠØ¯Ù‡.` :
                        `Bloquer ${selectedTarget} empÃªchera l'accÃ¨s Ã  tout le site !`;
                } else {
                    warningBox.style.display = 'none';
                }
            }
        });

        // ==================== DESCRIPTION CATÃ‰GORIE ====================
        
        document.getElementById('categorySelect').addEventListener('change', function() {
            const category = this.value;
            const descDiv = document.getElementById('categoryDescription');
            const descText = document.getElementById('descriptionText');
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            
            if (category && translations[currentLang].descriptions[category]) {
                descText.textContent = translations[currentLang].descriptions[category];
                descDiv.style.display = 'block';
            } else {
                descDiv.style.display = 'none';
            }
        });

        // ==================== SOUMISSION DU FORMULAIRE ====================
        
        document.getElementById('siteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            
            if (!selectedTarget) {
                alert(currentLang === 'ar' ? 
                    'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø§ ØªØ±ÙŠØ¯ ØªØµÙ†ÙŠÙÙ‡ Ø¨Ø§Ù„Ø¶Ø¨Ø·' : 
                    'âš ï¸ Veuillez choisir ce que vous voulez catÃ©goriser');
                return;
            }
            
            const category = document.getElementById('categorySelect').value;
            const reason = document.getElementById('reasonInput').value;
            const contributor = document.getElementById('contributorInput').value;
            const resultCard = document.getElementById('resultCard');
            
            resultCard.style.display = 'block';
            resultCard.innerHTML = '<div style="text-align: center; padding: 20px;"><b>â³ ' + 
                (currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'Envoi en cours...') + 
                '</b></div>';
            
            try {
                const response = await fetch('https://cat-dznet1.anvil.app/_/api/check_or_submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        domain: selectedTarget,
                        category: category,
                        reason: reason,
                        contributor: contributor
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    resultCard.innerHTML = `
                        <div style="background: #ffebee; padding: 20px; border-radius: 12px; color: #c62828;">
                            âŒ ${data.message || data.error}
                        </div>
                    `;
                    return;
                }
                
                displayResult(data);
                
                // âœ¨ NOUVEAU : Recharger les statistiques et la liste aprÃ¨s ajout
                if (data.action === 'created') {
                    setTimeout(() => {
                        loadStatistics();
                        loadRecentSites();
                    }, 1000);
                }
                
            } catch (error) {
                console.error(error);
                resultCard.innerHTML = `
                    <div style="background: #ffebee; padding: 20px; border-radius: 12px; color: #c62828;">
                        âš ï¸ ${currentLang === 'ar' ? 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…' : 'Erreur de connexion au serveur'}
                    </div>
                `;
            }
        });

        function displayResult(data) {
            const resultCard = document.getElementById('resultCard');
            const currentLang = document.documentElement.getAttribute('lang') || 'ar';
            const t = translations[currentLang];
            
            const categoryName = t.categories[data.category] || data.category;
            const statusName = t.statuses[data.status] || data.status;
            const validationStatusName = t.statuses[data.validation_status] || data.validation_status;
            
            let message = '';
            if (data.action === 'found') {
                message = currentLang === 'ar' ? 
                    'âœ… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' : 
                    'âœ… Site trouvÃ© dans la base de donnÃ©es';
            } else if (data.action === 'created') {
                message = currentLang === 'ar' ? 
                    'ğŸ‰ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­! Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.' : 
                    'ğŸ‰ Site ajoutÃ© avec succÃ¨s ! En cours de rÃ©vision.';
            }
            
            resultCard.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 20px; text-align: right; direction: rtl;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: #004080;">ğŸŒ ${data.domain}</h3>
                        <p style="color: #28a745; font-weight: bold;">${message}</p>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; font-size: 15px;">
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">ğŸ“ ${currentLang === 'ar' ? 'Ø§Ù„ÙØ¦Ø©' : 'CatÃ©gorie'}:</td>
                            <td style="padding: 8px;">${categoryName}</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">ğŸ“Š ${currentLang === 'ar' ? 'Ø§Ù„Ø­Ø§Ù„Ø©' : 'Statut'}:</td>
                            <td style="padding: 8px;">${statusName}</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">âœ… ${currentLang === 'ar' ? 'Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚' : 'Validation'}:</td>
                            <td style="padding: 8px;">${validationStatusName}</td>
                        </tr>
                        ${data.description ? `
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">ğŸ“ ${currentLang === 'ar' ? 'Ø§Ù„ÙˆØµÙ' : 'Description'}:</td>
                            <td style="padding: 8px;">${data.description}</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">ğŸ›¡ï¸ ${currentLang === 'ar' ? 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©' : 'Score'}:</td>
                            <td style="padding: 8px;">${data.trust_score}%</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">ğŸ‘¤ ${currentLang === 'ar' ? 'Ø§Ù„Ù…Ø¨Ù„Ù‘Øº' : 'RapportÃ© par'}:</td>
                            <td style="padding: 8px;">${data.reported_by || 'Ù…Ø¬Ù‡ÙˆÙ„'}</td>
                        </tr>
                        ${data.created_date ? `
                        <tr>
                            <td style="padding: 8px; font-weight: bold;">ğŸ“… ${currentLang === 'ar' ? 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©' : 'Date'}:</td>
                            <td style="padding: 8px;">${new Date(data.created_date).toLocaleString(currentLang === 'ar' ? 'ar-DZ' : 'fr-FR')}</td>
                        </tr>
                        ` : ''}
                    </table>
                </div>
            `;
        }
    </script>
    </script>
</body>
</html>
